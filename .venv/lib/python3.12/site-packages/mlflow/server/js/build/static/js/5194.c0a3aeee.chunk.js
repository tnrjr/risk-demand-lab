"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[5194],{45194:function(e,t,a){a.d(t,{$:function(){return te}});var i=a(89555),n=a(59403),s=a(10571),r=a(72069),l=a(91144),o=a(31014),d=a(68048),m=a(23823),c=a(7450);function u(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}var g=a(48624),T=a(9133),p=a(50111);const f=()=>({dateNow:new Date,setDateNow:e=>{}}),v=(0,o.createContext)(f()),b=({config:e,children:t})=>{const a=f(),i=(0,T.merge)({},a,e),[n,s]=o.useState(i.dateNow);return(0,p.Y)(v.Provider,{value:{...i,dateNow:n,setDateNow:s},children:t})},h=()=>{const e=(0,o.useContext)(v);return e||f()},S="startTimeLabel",y="startTime",Y="endTime",I="LAST_7_DAYS",w=()=>{var e;const t=h(),[a,i]=(0,g.ok)(),n=a.get(S)||I;let s=a.get(y)||void 0,r=null!==(e=a.get(Y))&&void 0!==e?e:void 0;if("CUSTOM"!==n){const e=x(t.dateNow,{startTimeLabel:n});s=e.startTime,r=e.endTime}else{var l;s=a.get(y)||void 0,r=null!==(l=a.get(Y))&&void 0!==l?l:void 0}const d=(0,o.useMemo)((()=>({startTimeLabel:n,startTime:s,endTime:r})),[n,s,r]),m=(0,o.useCallback)(((e,t=!1)=>{i((t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(y):"CUSTOM"===e.startTimeLabel&&t.set(y,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(Y):"CUSTOM"===e.startTimeLabel&&t.set(Y,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(S):t.set(S,e.startTimeLabel),t)),{replace:t})}),[i]);return[d,m]};function x(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}var L=a(72025);const A=o.memo((()=>{const e=(0,c.tz)(),{theme:t}=(0,n.u)(),[a,s]=w(),r=(0,o.useMemo)((()=>u(e)),[e]),l=e.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),g=h();return(0,p.FD)("div",{css:(0,i.AH)({display:"flex",gap:t.spacing.sm,alignItems:"center"},""),children:[(0,p.FD)(d.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:l,value:a.startTimeLabel?[a.startTimeLabel]:[I],children:[(0,p.Y)(d.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=r.find((t=>t.key===e)))||void 0===t?void 0:t.label},allowClear:!(0,T.isNil)(a.startTimeLabel)&&a.startTimeLabel!==I,onClear:()=>{s({startTimeLabel:I})},"data-testid":"time-range-select-dropdown"}),(0,p.Y)(d.DialogComboboxContent,{children:(0,p.Y)(d.DialogComboboxOptionList,{children:r.map((e=>(0,p.Y)(d.DialogComboboxOptionListSelectItem,{checked:a.startTimeLabel===e.key||e.key===I&&(0,T.isNil)(a.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{s({...a,startTimeLabel:e.key})},children:e.label},e.key)))})})]}),"CUSTOM"===a.startTimeLabel&&(0,p.Y)(p.FK,{children:(0,p.Y)(L.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(a.startTime),to:a.endTime?new Date(a.endTime):g.dateNow},onChange:e=>{const t=e.target.value;s({...a,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:g.dateNow}},value:a.startTime?new Date(a.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:g.dateNow}},value:a.endTime?new Date(a.endTime):void 0}})}),(0,p.Y)(m.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:g.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,p.Y)(n.B,{type:"link",componentId:"mlflow.experiment-evaluation-monitoring.refresh-date-button",onClick:()=>g.setDateNow(new Date),children:(0,p.Y)(d.RefreshIcon,{})})})]})}));var C=a(24759),D=a(63528),M=a(11473),k=a(10939),E=a(2250),R=a(70169),N=a(72314),O=a(83667),_=a(25866),F=a(36432);const U=e=>{const{experimentIds:t}=e,a=(0,c.tz)(),{data:i,isLoading:s,error:r}=(0,C.Zn)({experimentId:t[0],pageSize:1,limit:1}),{data:l,loading:m}=(0,N.L)({experimentId:t[0]}),g=l,T=(0,O.BH)(null===g||void 0===g?void 0:g.tags),f=(T===_.Gk.GENAI_DEVELOPMENT||_.Gk.GENAI_DEVELOPMENT_INFERRED,i&&i.length>0),[v,b]=w(),h=(0,o.useMemo)((()=>u(a)),[a]),S=(0,p.Y)(n.B,{componentId:"traces-v3-empty-state-button",onClick:()=>b({startTimeLabel:"ALL"}),children:(0,p.Y)(c.sA,{id:"WpD2MA",defaultMessage:"View All"})});if(s||m)return(0,p.Y)(p.FK,{children:[...Array(10).keys()].map((e=>(0,p.Y)(d.ParagraphSkeleton,{label:"Loading...",seed:`s-${e}`},e)))});if(r)return(0,p.Y)(d.Empty,{image:(0,p.Y)(n.l,{}),title:(0,p.Y)(c.sA,{id:"ZotI2j",defaultMessage:"Fetching traces failed"}),description:String(r)});if(f){var y;const e=(0,p.Y)(R.S,{}),t=(0,p.Y)(c.sA,{id:"XuzIWs",defaultMessage:'Some traces are hidden by your time range filter: "{filterLabel}"',values:{filterLabel:(0,p.Y)("strong",{children:(null===(y=h.find((e=>e.key===v.startTimeLabel)))||void 0===y?void 0:y.label)||""})}});return(0,p.Y)(d.Empty,{title:(0,p.Y)(c.sA,{id:"Dhr3pC",defaultMessage:"No traces found"}),description:t,button:S,image:e})}return(0,p.Y)(F.i,{baseComponentId:"mlflow.traces"})};var P=a(27288);var H={name:"1dd35ky",styles:"display:flex;flex:1;overflow:hidden"},$={name:"1dd35ky",styles:"display:flex;flex:1;overflow:hidden"},B={name:"db3fum",styles:"display:flex;flex-direction:column;width:100%;gap:8px;padding:16px"},G={name:"1w1qal4",styles:"display:flex;align-items:center;justify-content:center;width:100%;height:100%"},V={name:"1nxh63r",styles:"overflow-y:hidden;height:100%;display:flex;flex-direction:column"};const W=o.memo((({experimentId:e,endpointName:t,timeRange:a,loggedModelId:i})=>{const s=(0,M.N9)(),r=(0,c.tz)(),m=(0,l.rE)(),{assessmentInfos:u,allColumns:T,totalCount:f,isLoading:v,error:b,isEmpty:h,tableFilterOptions:y}=(0,C.KW)({experimentId:e,timeRange:a,filterByLoggedModelId:i}),[Y,I]=(0,o.useState)(""),[x,L]=(0,C.R7)(),A=(0,P.jE)(),R=(0,o.useCallback)((e=>e.filter((e=>e.type===C.$6.ASSESSMENT||e.type===C.$6.INPUT||e.type===C.$6.TRACE_INFO&&[C.tj,C.Rl,C.Te,C.$W,C.YO].includes(e.id)||e.type===C.$6.INTERNAL_MONITOR_REQUEST_TIME))),[]),{selectedColumns:N,toggleColumns:O,setSelectedColumns:_}=(0,C.K0)(e,T,R),[F,W]=(0,C.GY)(N,{key:C.Te,type:C.$6.TRACE_INFO,asc:!1}),{isInitialTimeFilterLoading:q}=(({experimentId:e,isTracesEmpty:t,isTraceMetadataLoading:a})=>{const[i]=(0,g.ok)(),[n,s]=w(),r=t&&!a&&!i.has(S),{data:l,isLoading:o}=(0,C.Zn)({experimentId:e,tableSort:{key:C.Te,type:C.$6.TRACE_INFO,asc:!1},disabled:!r,limit:500,pageSize:500});r&&l&&l.length>0&&!o&&s({startTimeLabel:"CUSTOM",startTime:l[l.length-1].request_time,endTime:(new Date).toISOString()});return{isInitialTimeFilterLoading:r&&o}})({experimentId:e,isTracesEmpty:h,isTraceMetadataLoading:v}),{data:K,isLoading:j,error:z}=(0,C.Zn)({experimentId:e,currentRunDisplayName:t,searchQuery:Y,filters:x,timeRange:a,filterByLoggedModelId:i,tableSort:F}),Q=(0,o.useCallback)((async(e,t)=>{var a;const[i,n]=await Promise.all([t?D.x.getExperimentTraceInfoV3(t):void 0,t?D.x.getExperimentTraceData(t):void 0]);return n?{info:(null===i||void 0===i||null===(a=i.trace)||void 0===a?void 0:a.trace_info)||{},data:n}:void 0}),[]),Z=(0,k.C)(),{showEditTagsModalForTrace:J,EditTagsModal:X}=(0,E.$)({onSuccess:()=>(0,C.BL)({queryClient:A}),existingTagKeys:(0,C.d9)(K||[]),useV3Apis:!0}),ee=(0,o.useMemo)((()=>({deleteTracesAction:{deleteTraces:(e,t)=>Z.mutateAsync({experimentId:e,traceRequestIds:t})},exportToEvals:{exportToEvalsInstanceEnabled:!0,getTrace:Q},editTags:{showEditTagsModalForTrace:J,EditTagsModal:X}})),[Q,Z,J,X]),te=(0,o.useMemo)((()=>({currentCount:null===K||void 0===K?void 0:K.length,logCountLoading:j,totalCount:f,maxAllowedCount:(0,C.pR)()})),[K,f,j]),ae=j||q||v,ie=z||b,ne=h&&!ae&&!ie;return!m&&ne?(0,p.Y)(U,{experimentIds:[e]}):(0,p.Y)(C.sG,{children:(0,p.FD)("div",{css:V,children:[(0,p.Y)(C.w_,{experimentId:e,searchQuery:Y,setSearchQuery:I,filters:x,setFilters:L,assessmentInfos:u,traceInfos:K,tableFilterOptions:y,countInfo:te,traceActions:ee,tableSort:F,setTableSort:W,allColumns:T,selectedColumns:N,toggleColumns:O,setSelectedColumns:_,isMetadataLoading:v,metadataError:b}),!m&&ne?(0,p.Y)(U,{experimentIds:[e]}):(0,p.Y)("div",{css:H,children:(0,p.Y)("div",{css:$,children:ae?(0,p.Y)("div",{css:B,children:[...Array(10).keys()].map((e=>(0,p.Y)(d.ParagraphSkeleton,{label:"Loading...",seed:`s-${e}`},e)))}):ie?(0,p.Y)("div",{css:G,children:(0,p.Y)(d.Empty,{image:(0,p.Y)(n.l,{}),title:r.formatMessage({id:"Bcr4hl",defaultMessage:"Fetching traces failed"}),description:ie.message})}):(0,p.Y)(C.tU,{makeHtml:s,children:(0,p.Y)(C._p,{experimentId:e,allColumns:T,currentTraceInfoV3:K||[],currentRunDisplayName:t,getTrace:Q,assessmentInfos:u,setFilters:L,filters:x,selectedColumns:N,tableSort:F})})})})]})})}));var q=a(28486);var K={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const j=({error:e})=>{var t;return(0,p.Y)(d.PageWrapper,{css:K,children:(0,p.Y)(d.Empty,{"data-testid":"fallback",title:(0,p.Y)(c.sA,{id:"FbAMd+",defaultMessage:"Error"}),description:null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:(0,p.Y)(c.sA,{id:"CbzDeZ",defaultMessage:"An error occurred while rendering this component."}),image:(0,p.Y)(n.l,{})})})},z=({children:e})=>(0,p.Y)(q.tH,{fallback:(0,p.Y)(j,{}),children:e}),Q="viewState",Z=()=>{const{theme:e}=(0,n.u)();return(0,p.Y)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${e.colors.grey100}`,paddingBottom:`${e.spacing.sm}px`},""),children:(0,p.Y)(A,{})})},J=({viewState:e,experimentId:t,endpointName:a,timeRange:i})=>"logs"===e?(0,p.Y)(W,{experimentId:t||"",endpointName:a||"dummy-run",timeRange:i}):null,X=({experimentIds:e})=>{const{theme:t}=(0,n.u)(),[a,s]=w(),r=h(),d=e[0],[m]=(()=>{var e;const[t,a]=(0,g.ok)(),i=null!==(e=t.get(Q))&&void 0!==e?e:"logs",n=(0,o.useCallback)(((e,t=!1)=>{a((t=>void 0===e?(t.delete(Q),t):(t.set(Q,e),t)),{replace:t})}),[a]);return[i,n]})(),c=(0,o.useMemo)((()=>{const{startTime:e,endTime:t}=x(r.dateNow,a);return{startTime:e?new Date(e).getTime().toString():void 0,endTime:t?new Date(t).getTime().toString():void 0}}),[r.dateNow,a]);return(0,p.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,height:"100%",overflowY:"hidden"},""),children:[(0,l.$Y)()&&(0,p.Y)(Z,{}),(0,p.Y)(J,{viewState:m,experimentId:d,timeRange:c})]})},ee=({experimentIds:e})=>(0,p.Y)(z,{children:(0,p.Y)(b,{children:(0,p.Y)(X,{experimentIds:e})})}),te=({experimentIds:e})=>{const{theme:t}=(0,n.u)();return(0,p.FD)("div",{css:(0,i.AH)({minHeight:225,display:"flex",flexDirection:"column",gap:t.spacing.sm,flex:1,overflow:"hidden"},""),children:[(0,l.w7)()?null:(0,p.Y)(r.W,{hideBorder:!1}),(0,p.Y)(ae,{experimentIds:e})]})},ae=({experimentIds:e})=>(0,l.v3)()||(0,l.$Y)()?(0,p.Y)(ee,{experimentIds:e}):(0,p.Y)(s.O,{experimentIds:e})},72069:function(e,t,a){a.d(t,{W:function(){return c}});var i=a(59403),n=a(68048),s=a(88443),r=a(30214),l=a(53660),o=a(91144),d=a(3546),m=a(50111);const c=({viewState:e,runsAreGrouped:t,hideBorder:a=!0})=>{const[,c]=(0,d.sR)(),{theme:u}=(0,i.u)(),[g,T]=(0,l.an)(),{classNamePrefix:p}=(0,i.u)(),f=g||(0,l.mb)(),v=((0,o.GV)()?["TABLE","CHART","ARTIFACT"]:["TABLE","CHART"]).includes(f)?"RUNS":f,b=1===c.length?c[0]:void 0;return(0,m.FD)(n.LegacyTabs,{dangerouslyAppendEmotionCSS:{[`.${p}-tabs-nav`]:{marginBottom:0,"::before":{display:a?"none":"block"}}},activeKey:v,onChange:e=>{const t=e;if(v!==t)return"RUNS"===t?T("TABLE"):void T(t,b)},children:[(0,m.Y)(n.LegacyTabs.TabPane,{tab:(0,m.Y)("span",{"data-testid":"experiment-runs-mode-switch-combined",children:(0,m.Y)(s.A,{id:"qpFaad",defaultMessage:"Runs"})})},"RUNS"),b&&(0,m.Y)(n.LegacyTabs.TabPane,{tab:(0,m.FD)("span",{"data-testid":"experiment-runs-mode-switch-models",children:[(0,m.Y)(s.A,{id:"b8rdDM",defaultMessage:"Models"}),(0,m.Y)(r.W,{})]})},"MODELS"),(0,m.Y)(n.LegacyTabs.TabPane,{disabled:(0,o.GV)()||t,tab:(0,m.Y)(n.LegacyTooltip,{title:!(0,o.GV)()&&t?(0,m.Y)(s.A,{id:"YOp3/x",defaultMessage:"Unavailable when runs are grouped"}):void 0,children:(0,m.FD)("span",{"data-testid":"experiment-runs-mode-switch-evaluation",css:(0,o.GV)()&&{display:"inline-flex",alignItems:"center",gap:u.spacing.xs},children:[(0,m.Y)(s.A,{id:"SCqKp8",defaultMessage:"Evaluation"}),(0,o.GV)()?(0,m.Y)(n.InfoPopover,{popoverProps:{maxWidth:350},iconProps:{style:{marginRight:0}},children:(0,m.Y)(s.A,{id:"sFPlmE",defaultMessage:'Accessing artifact evaluation by "Evaluation" tab is being discontinued. In order to use this feature, use <link>"Artifacts evaluation" mode in Runs tab</link> instead.',values:{link:e=>"ARTIFACT"===g?e:(0,m.Y)(i.T.Link,{componentId:"mlflow.experiment_page.evaluation_tab_migration_info_link",onClick:()=>T("ARTIFACT",b),children:e})}})}):(0,m.Y)(r.W,{})]})})},"ARTIFACT"),(0,m.Y)(n.LegacyTabs.TabPane,{tab:(0,m.Y)("span",{"data-testid":"experiment-runs-mode-switch-traces",children:(0,m.Y)(s.A,{id:"AGQOPV",defaultMessage:"Traces"})})},"TRACES")]})}}}]);
//# sourceMappingURL=5194.c0a3aeee.chunk.js.map