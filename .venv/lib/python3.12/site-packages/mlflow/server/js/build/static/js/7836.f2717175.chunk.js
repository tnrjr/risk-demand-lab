"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[7836],{13453:function(e,t,s){s.d(t,{a:function(){return Qs}});var n=s(89555),r=s(31014),i=s(28486),a=s(59403),o=s(68048),l=s(7450),d=s(17297),c=s(46932),u=s(9133),p=s(15230),m=s(94026),g=s(50111);var h={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},f={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},v={name:"kjqqaz",styles:"width:0;position:relative"};var x=(0,r.forwardRef)((({initialRatio:e,paneWidth:t,setPaneWidth:s,leftChild:i,leftMinWidth:o,rightChild:l,rightMinWidth:d},c)=>{var x;const[y,b]=(0,r.useState)(!1),Y=(0,r.useRef)(null),S=null===(x=(0,m.wY)({ref:Y}))||void 0===x?void 0:x.width,A=(null!==S&&void 0!==S?S:1/0)-d,w=(0,r.useRef)(e),{theme:T}=(0,a.u)(),M=(0,r.useCallback)((e=>{S&&(w.current=e/S)}),[S]);return(0,r.useImperativeHandle)(c,(()=>({updateRatio:M}))),(0,r.useLayoutEffect)((()=>{S&&s((0,u.clamp)(S*w.current,o,A))}),[S,A,o,d,s]),(0,g.FD)("div",{ref:Y,css:f,children:[y&&(0,g.Y)(n.mL,{styles:h}),(0,g.Y)(p.ResizableBox,{axis:"x",width:t,css:(0,n.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,g.Y)("div",{css:v,children:(0,g.Y)("div",{css:(0,n.AH)({position:"relative",width:T.spacing.sm,marginLeft:-T.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const n=(0,u.clamp)(t.width,o,A);s(n),S&&(w.current=n/S)},onResizeStart:()=>b(!0),onResizeStop:()=>b(!1),minConstraints:[o,1/0],maxConstraints:[A,1/0],children:i}),l]})})),y=s(76137),b=s(70169);var Y={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var S=({searchFilter:e,setSearchFilter:t,matchData:s,handleNextSearchMatch:i,handlePreviousSearchMatch:l})=>{const[d,c]=(0,r.useState)(e),u=(0,y.YQ)(t,350),{theme:p}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:p.spacing.sm},""),children:[(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:d,onClear:()=>{t(""),c("")},onChange:e=>{c(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,g.Y)(b.S,{}),css:Y}),s.match&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",marginLeft:p.spacing.xs,marginRight:p.spacing.sm,alignItems:"center"},""),children:[(0,g.FD)(a.T.Text,{css:(0,n.AH)({whiteSpace:"nowrap",marginRight:p.spacing.sm},""),children:[s.currentMatchIndex+1," / ",s.totalMatches]}),(0,g.Y)(a.B,{"data-testid":"prev-search-match",icon:(0,g.Y)(o.ChevronUpIcon,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,g.Y)(a.B,{"data-testid":"next-search-match",icon:(0,g.Y)(o.ChevronDownIcon,{}),onClick:i,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const A=1/0,w=5,T=3,M=1,D=e=>{const t=[],s=e=>{var n;e&&(t.push(e),null===(n=e.children)||void 0===n||n.forEach(s))};return e.forEach(s),t},I=(e,t=1/0)=>{const s={},n=(e,r)=>{var i;!e||r>t||(s[e.key]=e,null===(i=e.children)||void 0===i||i.forEach((e=>n(e,r+1))))};return e.forEach(n,0),s},k=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},C=(e,t)=>{var s;return e.key===t?0:(null!==(s=e.children)&&void 0!==s?s:[]).findIndex((e=>C(e,t)>-1))},F=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const s=e.children.map(F);return Math.max(...s)+1},H=(0,r.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),N=()=>(0,r.useContext)(H),R=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:s,assessmentsPaneEnabled:n,children:i})=>{var a,o,l;const d=(0,r.useMemo)((()=>(0,c.jW)(e)),[e]),u=(0,r.useMemo)((()=>d?I([d]):{}),[d]),p=(0,c.f7)(d,s),m=null!==(a=null!==p&&void 0!==p?p:d)&&void 0!==a?a:void 0,h=(null!==(o=null===m||void 0===m||null===(l=m.assessments)||void 0===l?void 0:l.length)&&void 0!==o?o:0)>0,[f,v]=(0,r.useState)(t),[x,y]=(0,r.useState)(m),[b,Y]=(0,r.useState)(null!==x&&void 0!==x&&x.chatMessages?"chat":"content"),[S,A]=(0,r.useState)(!1),[w,T]=(0,r.useState)(h),M=(0,r.useMemo)((()=>({rootNode:d,nodeMap:u,activeView:f,setActiveView:v,activeTab:b,setActiveTab:Y,selectedNode:x,setSelectedNode:y,showTimelineTreeGantt:S,setShowTimelineTreeGantt:A,assessmentsPaneExpanded:w,setAssessmentsPaneExpanded:T,assessmentsPaneEnabled:n})),[f,u,b,d,x,S,A,w,T,n]);return(0,g.Y)(H.Provider,{value:M,children:i})},_=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},E=({treeNode:e,selectedNode:t,setSelectedNode:s,setActiveTab:n,setExpandedKeys:i,modelTraceInfo:a})=>{var o;const[l,d]=(0,r.useState)(""),[p,m]=(0,r.useState)((()=>(e=>{const t={};e&&(0,u.compact)(D([e]).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[g,h]=(0,r.useState)(0),{filteredTreeNodes:f,matches:v}=(0,r.useMemo)((()=>(0,u.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,c.vL)(e,l,p)),[null===e||void 0===e?void 0:e.key,l,p,a]),x=(0,r.useMemo)((()=>I(f)),[f]),y=(0,r.useCallback)((e=>{if(e>=v.length||e<0)return;h(e);const t=v[e];s(t.span),n(_(t));const r=((e,t)=>{const s=new Set;let n=e;for(;n&&n.parentId;)s.add(n.parentId),n=t[n.parentId];return s})(t.span,x);i((e=>new Set([...e,...r])))}),[v,s,n,x,i]),b=(0,r.useCallback)((()=>{y(g+1)}),[g,y]),Y=(0,r.useCallback)((()=>{y(g-1)}),[g,y]);return(0,r.useLayoutEffect)((()=>{if(0!==f.length)if(0!==v.length)h(0),s(v[0].span),n(_(v[0]));else{var e;const r=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(r in x)s(x[r]);else{const e=f[0];s(e),n(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,v,s]),{matchData:{match:null!==(o=v[g])&&void 0!==o?o:null,totalMatches:v.length,currentMatchIndex:g},searchFilter:l.toLowerCase().trim(),setSearchFilter:d,spanFilterState:p,setSpanFilterState:m,filteredTreeNodes:f,handleNextSearchMatch:b,handlePreviousSearchMatch:Y}};var B=s(48563);const j="yellow500",z="yellow200",O=({searchFilter:e,data:t,activeMatch:s,containsActiveMatch:i})=>{const{theme:o}=(0,a.u)(),l=(0,r.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),d=(0,r.useMemo)((()=>e?(0,c.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:o.colors[j],inactiveMatchBackgroundColor:o.colors[z],containsActiveMatch:i,activeMatch:s,scrollToActiveMatch:l}):[]),[e,t,o,i,s,l]);return(0,g.Y)("pre",{css:(0,n.AH)({whiteSpace:"pre-wrap",backgroundColor:o.colors.backgroundSecondary,padding:o.spacing.sm,fontSize:o.typography.fontSizeSm},""),children:d})};var L=s(74396),K=s(55921),$=s(20897),P=s(22734);var V={name:"1qmr6ab",styles:"overflow:auto"},W={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const U=({children:e})=>(0,g.Y)("div",{"data-testid":"basic-table",css:V,children:(0,g.Y)(o.Table,{scrollable:!0,css:W,children:e})}),J=({children:e,node:t})=>{const{header:s,rows:n,isValid:i}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const s=r.Children.toArray(e);return{header:null!==(t=s[0])&&void 0!==t?t:void 0,rows:s.slice(1).flatMap((e=>r.isValidElement(e)?r.Children.toArray(e.props.children).filter((e=>r.isValidElement(e))):[])),isValid:!0}}({children:e,node:t});return i?(0,g.Y)(G,{header:s,rows:n}):(0,g.Y)(U,{children:e,node:t})};var q={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const G=({header:e,rows:t})=>{const{theme:s}=(0,a.u)(),i=r.useRef(null),l=(0,P.z)({size:t.length,parentRef:i,overscan:20}),{virtualItems:d,totalSize:c}=l;return(0,g.Y)("div",{"data-testid":"virtualized-table",ref:i,css:(0,n.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:s.colors.border,borderRadius:s.borders.borderRadiusMd,marginBottom:s.spacing.md,zIndex:0},""),children:(0,g.FD)(o.Table,{css:q,children:[e,(0,g.Y)("div",{css:(0,n.AH)({position:"relative",height:`${c}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:d.map((e=>{const s=e.index,r=t[s];return(0,g.Y)("div",{ref:e.measureRef,css:(0,n.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:r},s)}))})]})})},Z=({children:e,node:t})=>{const s=null===t||void 0===t?void 0:t.children.some((e=>"th"===e.tagName)),{theme:n}=(0,a.u)();return(0,g.Y)(o.TableRow,{style:s?{position:"sticky",top:0,zIndex:1,backgroundColor:n.colors.backgroundPrimary}:void 0,children:e,isHeader:s})},X=({children:e,node:t})=>{const s="th"===(null===t||void 0===t?void 0:t.tagName),{theme:r}=(0,a.u)();return s?(0,g.Y)(o.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,n.AH)({paddingLeft:r.spacing.sm,borderColor:r.colors.border,color:r.colors.textPrimary},""),children:e}):(0,g.Y)(o.TableCell,{children:e})};const Q=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,L.Lv)(e),ee=e=>{const t=(0,r.useMemo)((()=>oe({extensions:e.components})),[e.components]);return(0,g.Y)(L.oz,{components:t,remarkPlugins:ie,urlTransform:Q,children:e.children})},te=({codeBlock:e,codeInline:t,node:s,...n})=>{var i,a;const o=r.useMemo((()=>{var e;const t=/language-(\w+)/.exec(null!==(e=n.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0}),[n.className]);return(null===s||void 0===s||null===(i=s.position)||void 0===i?void 0:i.start.line)===(null===s||void 0===s||null===(a=s.position)||void 0===a?void 0:a.end.line)?r.createElement(t,n):r.createElement(e,{...n,language:o})},se=({children:e})=>(0,g.Y)(a.T.Text,{code:!0,children:e});var ne={name:"bjn8wh",styles:"position:relative"};const re=r.memo((({children:e,language:t})=>{const{theme:s}=(0,a.u)(),n=String(e).replace(/\n$/,"");return(0,g.Y)("div",{css:ne,children:(0,g.Y)($.z7,{actions:(0,g.Y)($.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:n}),theme:s.isDarkMode?"duotoneDark":"light",children:n,language:t&&le(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})})),ie=[K.A];var ae={name:"qhxz92",styles:"max-width:100%"};const oe=e=>({a:({href:e,children:t})=>(0,g.Y)(a.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,g.FD)(g.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var s,n,r,i;return(0,g.Y)(te,{...t,codeBlock:null!==(s=null===(n=e.extensions)||void 0===n?void 0:n.codeBlock)&&void 0!==s?s:re,codeInline:null!==(r=null===(i=e.extensions)||void 0===i?void 0:i.codeInline)&&void 0!==r?r:se})},p:({children:e})=>(0,g.Y)(a.T.Paragraph,{children:e}),h1:({children:e})=>(0,g.Y)(a.T.Title,{level:1,children:e}),h2:({children:e})=>(0,g.Y)(a.T.Title,{level:2,children:e}),h3:({children:e})=>(0,g.Y)(a.T.Title,{level:3,children:e}),h4:({children:e})=>(0,g.Y)(a.T.Title,{level:4,children:e}),h5:({children:e})=>(0,g.Y)(a.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,g.Y)(J,{children:e,node:t}),tr:({children:e,node:t})=>(0,g.Y)(Z,{children:e,node:t}),th:({children:e,node:t})=>(0,g.Y)(X,{children:e,node:t}),td:({children:e})=>(0,g.Y)(o.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,g.Y)(g.FK,{children:e}),tbody:({children:e})=>(0,g.Y)(g.FK,{children:e}),img:({src:e,alt:t})=>(0,g.Y)("img",{src:e,alt:t,css:ae})}),le=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}};var de={name:"bjn8wh",styles:"position:relative"},ce={name:"n31mhe",styles:"width:100%;padding:0"};function ue({data:e,searchFilter:t="",activeMatch:s=null,containsActiveMatch:i=!1,renderMode:d=B.cC.JSON}){const c=Boolean(t)&&!(0,u.isNil)(s)&&e.toLowerCase().includes(t),{theme:p}=(0,a.u)(),[m,h]=(0,r.useState)("json"===d),[f,v]=(0,r.useState)(c),x=(0,r.useRef)(null),y=(0,r.useMemo)((()=>{if("json"===d)return e;const t=JSON.parse(e);return(0,u.isString)(t)?t:e}),[e,d]),b=m||y.split("\n").length>4||y.length>300,Y=(0,r.useMemo)((()=>{if(b&&!f){const e=y.split("\n").slice(0,4).join("\n");return e.length>300?e.slice(0,300):e}return y}),[y,b,f]);(0,r.useEffect)((()=>{x.current&&h(x.current.scrollWidth>x.current.clientWidth)}),[e]);const S=(0,r.useCallback)((e=>(0,g.Y)("pre",{...e,ref:x})),[]);return c?(0,g.Y)(O,{data:e,searchFilter:t,activeMatch:s,containsActiveMatch:!s.isKeyMatch&&i}):(0,g.FD)("div",{css:de,children:["markdown"===d?(0,g.Y)("div",{css:(0,n.AH)({padding:p.spacing.md,backgroundColor:p.colors.backgroundSecondary,marginBottom:-p.spacing.md},""),children:(0,g.Y)(ee,{children:Y})}):(0,g.FD)(g.FK,{children:[(0,g.Y)($.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,n.AH)({position:"absolute",top:p.spacing.xs,right:p.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,g.Y)($.z7,{PreTag:S,showLineNumbers:!0,language:d,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:f,theme:p.isDarkMode?"duotoneDark":"light",style:{backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.sm,paddingBottom:b?0:p.spacing.sm,paddingRight:2*p.spacing.md,overflow:f?"auto":"hidden",textOverflow:"ellipsis",fontSize:p.typography.fontSizeSm,lineHeight:p.typography.lineHeightBase},children:Y})]}),b&&(0,g.Y)("div",{css:(0,n.AH)({backgroundColor:p.colors.backgroundSecondary},""),children:(0,g.Y)(a.B,{css:ce,componentId:f?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:f?(0,g.Y)(o.ChevronUpIcon,{}):(0,g.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>v(!f),children:f?(0,g.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}const pe=({title:e,searchFilter:t,isActiveMatch:s})=>{const{theme:i}=(0,a.u)(),o=(0,r.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),l=e.toLowerCase();if(!l.includes(t))return(0,g.Y)("div",{children:e});const d=l.indexOf(t),c=d+t.length,u=s?i.colors[j]:i.colors[z];return(0,g.FD)("div",{children:[e.slice(0,d),(0,g.Y)("span",{ref:s?o:null,css:(0,n.AH)({backgroundColor:u,scrollMarginTop:50},""),children:e.slice(d,c)}),e.slice(c)]})};function me(e,t){return t||(e?B.cC.MARKDOWN:B.cC.JSON)}function ge(e){switch(e){case B.cC.JSON:return"JSON";case B.cC.TEXT:return"Text";case B.cC.MARKDOWN:return"Markdown"}}var he={name:"bjn8wh",styles:"position:relative"},fe={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ve={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},xe={name:"2fp7nl",styles:"height:min-content;margin:0"};function ye({title:e,tokens:t,data:s,searchFilter:i="",activeMatch:l=null,containsActiveMatch:d=!1,initialRenderMode:c}){var p;const m=(0,r.useMemo)((()=>JSON.parse(s)),[s]),h=(0,u.isString)(m),{theme:f}=(0,a.u)(),[v,x]=(0,r.useState)(me(h,c)),y=d&&null!==(p=null===l||void 0===l?void 0:l.isKeyMatch)&&void 0!==p&&p,b=h&&!i;return(0,r.useEffect)((()=>{x(me(h,c))}),[h,c]),(0,g.Y)("div",{css:he,children:(0,g.FD)("div",{css:(0,n.AH)({borderRadius:f.borders.borderRadiusSm,border:`1px solid ${f.colors.border}`,overflow:"hidden"},""),children:[(e||b)&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:f.spacing.sm},""),children:[(0,g.Y)(a.T.Title,{css:fe,level:4,color:"secondary",withoutMargins:!0,children:(0,g.Y)(pe,{title:e,searchFilter:i,isActiveMatch:y})}),(0,g.Y)("div",{css:ve,children:b&&(0,g.FD)(o.DropdownMenu.Root,{children:[(0,g.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,g.Y)(o.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:xe,children:(0,g.FD)("div",{css:(0,n.AH)({paddingLeft:f.spacing.xs,marginRight:f.spacing.xs,cursor:"pointer"},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:ge(v)}),(0,g.Y)(o.ChevronDownIcon,{})]})})}),(0,g.FD)(o.DropdownMenu.Content,{children:[(0,g.Y)(o.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:v,onValueChange:e=>x(e),children:Object.values(B.cC).map((e=>(0,g.FD)(o.DropdownMenu.RadioItem,{value:e,children:[(0,g.Y)(o.DropdownMenu.ItemIndicator,{}),ge(e)]},e)))}),(0,g.Y)(o.DropdownMenu.Arrow,{})]})]})})]}),(0,g.Y)(ue,{data:s,searchFilter:i,activeMatch:l,containsActiveMatch:d,renderMode:v})]})})}function be({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:r}=(0,a.u)(),{attributes:i}=e,d=(0,u.keys)(i).length>0,c=!(0,u.isNil)(s)&&s.span.key===e.key;return!d||(0,u.isNil)(i)?(0,g.Y)("div",{css:(0,n.AH)({marginTop:r.spacing.md},""),children:(0,g.Y)(o.Empty,{description:(0,g.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,padding:r.spacing.md},""),children:Object.entries(i).map((([e,n])=>(0,g.Y)(ye,{title:e,data:JSON.stringify(n,null,2),searchFilter:t,activeMatch:s,containsActiveMatch:c&&"attributes"===s.section&&s.key===e},e)))})}function Ye({paramName:e,paramProperties:t,isRequired:s}){const{theme:r}=(0,a.u)(),{type:i,description:o,enum:d}=t,c=i||o||d,u=c?{borderTopLeftRadius:r.borders.borderRadiusMd,borderTopRightRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`}:{borderRadius:r.borders.borderRadiusMd};return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusMd,border:`1px solid ${r.colors.border}`},""),children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:r.colors.backgroundSecondary,padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,...u},""),children:[(0,g.Y)(a.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),s&&(0,g.Y)(a.T.Text,{withoutMargins:!0,color:"error",children:(0,g.Y)(l.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),c&&(0,g.FD)("div",{css:(0,n.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:r.spacing.md,padding:`${r.spacing.sm}px ${r.spacing.md}px`},""),children:[i&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,g.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:i})]}),o&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,g.Y)(a.T.Text,{withoutMargins:!0,children:o})]}),d&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,flexWrap:"wrap"},""),children:d.map((e=>(0,g.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function Se({tool:e}){var t,s,i;const{theme:l}=(0,a.u)(),[d,c]=(0,r.useState)(!1),u=e.function.description,p=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,m=null!==(s=null===(i=e.function.parameters)||void 0===i?void 0:i.required)&&void 0!==s?s:[],h=u||p,f=h?{":hover":{backgroundColor:l.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:l.borders.borderRadiusMd,border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,g.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm,alignItems:"center",borderBottom:h&&d?`1px solid ${l.colors.border}`:"none",padding:l.spacing.sm,...f},""),onClick:()=>c(!d),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[h&&(d?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{})),(0,g.Y)(a.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),h&&d&&(0,g.FD)("div",{css:(0,n.AH)({padding:l.spacing.sm},""),children:[u&&(0,g.Y)(a.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:l.spacing.sm,padding:`0px ${l.spacing.xs}px`},children:e.function.description}),p&&(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:Object.keys(p).map((e=>(0,g.Y)(Ye,{paramName:e,paramProperties:p[e],isRequired:m.includes(e)},e)))})]})]})}var Ae=s(23823),we=s(86494);const Te=e=>{switch(e){case"system":return(0,g.Y)(we.P,{type:B.Dy.SYSTEM});case"user":return(0,g.Y)(we.P,{type:B.Dy.USER});case"tool":case"function":return(0,g.Y)(we.P,{type:B.Dy.WRENCH});default:return(0,g.Y)(we.P,{type:B.Dy.MODELS})}},Me=e=>{switch(e.role){case"system":return(0,g.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,g.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,g.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,g.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,g.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var De={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},Ie={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const ke=({isExpandable:e,expanded:t,setExpanded:s,message:r})=>{const{theme:i}=(0,a.u)(),d=e?{":hover":{backgroundColor:i.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:i.spacing.sm,gap:i.spacing.sm,...d},""),onClick:()=>s(!t),children:[e&&(t?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{})),Te(r.role),r.tool_call_id?(0,g.Y)(a.T.Text,{color:"secondary",css:De,children:(0,g.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginRight:i.spacing.xs},""),bold:!0,children:Me(r)}),toolCallId:(0,g.Y)(Ae.T,{componentId:"test",content:r.tool_call_id,children:(0,g.Y)("div",{css:(0,n.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:i.spacing.xs},""),children:(0,g.Y)(a.T.Text,{css:Ie,code:!0,children:r.tool_call_id})})})}})}):(0,g.Y)(a.T.Text,{bold:!0,children:Me(r)})]})};var Ce={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function Fe({toolCall:e}){const{theme:t}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,g.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,g.FD)(o.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,n.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,g.Y)(o.FunctionIcon,{}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,g.Y)(Ae.T,{componentId:"test",content:e.id,children:(0,g.Y)("div",{css:(0,n.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,g.Y)(a.T.Text,{css:Ce,code:!0,color:"secondary",children:e.id})})})}})}),(0,g.Y)(ue,{data:e.function.arguments})]},e.id)}function He({content:e,shouldDisplayCodeSnippet:t}){const{theme:s}=(0,a.u)();return e?t?(0,g.Y)(ue,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:B.cC.JSON}):(0,g.Y)("div",{css:(0,n.AH)({padding:s.spacing.sm,paddingTop:0,marginBottom:-s.typography.fontSizeBase},""),children:(0,g.Y)(ee,{children:e})}):null}function Ne({message:e,className:t}){var s;const{theme:i}=(0,a.u)(),[d,c]=(0,r.useState)(!1),{content:p,isJson:m}=(e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}})(null!==(s=e.content)&&void 0!==s?s:""),h=m&&("tool"===e.role||"function"===e.role),f=!h&&p.length>300,v=f&&!d?`${p.slice(0,300)}...`:p;return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:i.borders.borderRadiusSm,border:`1px solid ${i.colors.border}`,backgroundColor:i.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,g.Y)(ke,{isExpandable:f,expanded:d,setExpanded:c,message:e}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:[!(0,u.isNil)(e.tool_calls)&&e.tool_calls.map((e=>(0,g.Y)(Fe,{toolCall:e},e.id))),(0,g.Y)(He,{content:v,shouldDisplayCodeSnippet:h})]}),f&&(0,g.Y)(a.B,{componentId:d?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:d?(0,g.Y)(o.ChevronUpIcon,{}):(0,g.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>c(!d),css:(0,n.AH)({display:"flex",width:"100%",padding:i.spacing.md,borderRadius:"0px !important"},""),children:d?(0,g.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function Re({messages:e}){const{theme:t}=(0,a.u)();return(0,u.isNil)(e)?null:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,g.Y)(Ne,{message:e},t)))})}var _e={name:"1d3w5wq",styles:"width:100%"};const Ee=({sectionKey:e,title:t,children:s,withBorder:i=!1,className:l})=>{const[d,c]=(0,r.useState)(!0),{theme:u}=(0,a.u)();return(0,g.FD)("div",{className:l,css:(0,n.AH)({display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},""),children:[(0,g.FD)("div",{css:(0,n.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:i?u.spacing.sm:0,background:i?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:d?0:u.borders.borderRadiusMd,borderBottomRightRadius:d?0:u.borders.borderRadiusMd,border:i?`1px solid ${u.colors.border}`:void 0,marginBottom:i?0:u.spacing.sm},""),children:[(0,g.Y)(a.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:d?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>c(!d)}),(0,g.Y)(a.T.Title,{withoutMargins:!0,level:4,css:_e,children:t})]}),d&&(0,g.Y)("div",{css:(0,n.AH)({border:i?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:i?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:i?u.borders.borderRadiusMd:void 0,padding:i?u.spacing.sm:0},""),children:s})]})};function Be({chatMessages:e,chatTools:t}){const{theme:s}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({overflowY:"auto",padding:s.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,g.Y)(Ee,{css:(0,n.AH)({marginBottom:s.spacing.sm},""),title:(0,g.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:t.map((e=>(0,g.Y)(Se,{tool:e},e.function.name)))})}),(0,g.Y)(Ee,{title:(0,g.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,g.Y)(Re,{messages:e})})]})}var je={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},ze={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function Oe({activeSpan:e,className:t,searchFilter:s,activeMatch:i}){const{theme:o}=(0,a.u)(),d=(0,r.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),p=(0,r.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,u.isNil)(e))return null;const m=d.length>0,h=p.length>0,f=!(0,u.isNil)(i)&&i.span.key===e.key;return(0,g.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,g.Y)(Ee,{withBorder:!0,css:(0,n.AH)({marginBottom:o.spacing.sm},""),sectionKey:"input",title:(0,g.Y)("div",{css:je,children:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:d.map((({key:e,value:t},n)=>(0,g.Y)(ye,{title:e,data:t,searchFilter:s,activeMatch:i,containsActiveMatch:f&&"inputs"===i.section&&i.key===e},e||n)))})}),h&&(0,g.Y)(Ee,{withBorder:!0,sectionKey:"output",title:(0,g.Y)("div",{css:ze,children:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:p.map((({key:e,value:t})=>(0,g.Y)(ye,{title:e,data:t,searchFilter:s,activeMatch:i,containsActiveMatch:f&&"outputs"===i.section&&i.key===e},e)))})})]})}const Le=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},Ke=({itemKey:e,itemValue:t,charLimit:s=18,maxWidth:r=150,className:i})=>{const{shouldTruncateKey:l,shouldTruncateValue:d}=function(e,t,s){const n=e.length+t.length,r=e.length>t.length,i=r?t.length:e.length;return n<=s?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>s/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(e,t,s);return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,g.Y)(o.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:i,children:(0,g.FD)("span",{css:(0,n.AH)({maxWidth:r,display:"inline-flex"},""),children:[(0,g.Y)(a.T.Text,{bold:!0,css:Le(l),size:"sm",children:e}),":\xa0",(0,g.Y)(a.T.Text,{css:Le(d),size:"sm",children:t})]})})})};var $e={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function Pe({text:e,metadataTags:t,setExpanded:s,logDocumentClick:r}){const{theme:i}=(0,a.u)();return(0,g.FD)("div",{css:$e,children:[(0,g.Y)("div",{role:"button",onClick:()=>{s(!1),null===r||void 0===r||r("collapse")},css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${i.spacing.sm}px ${i.spacing.md}px`,height:i.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:(0,g.Y)(o.FileDocumentIcon,{})}),(0,g.Y)("div",{css:(0,n.AH)({padding:i.spacing.md,paddingBottom:0},""),children:(0,g.Y)(ee,{children:e})}),(0,g.Y)("div",{css:(0,n.AH)({padding:i.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,g.Y)(Ke,{itemKey:e,itemValue:t},e)))}),(0,g.Y)(a.B,{css:(0,n.AH)({width:"100%",padding:i.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,g.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>s(!1),children:(0,g.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var Ve={name:"ti75j2",styles:"margin:0"},We={name:"1r5gb7q",styles:"display:inline-block"},Ue={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function Je({text:e,metadataTags:t,setExpanded:s,logDocumentClick:r}){const{theme:i}=(0,a.u)();return(0,g.FD)("div",{role:"button",onClick:()=>{s(!0),null===r||void 0===r||r("expand")},css:(0,n.AH)({display:"flex",flexDirection:"row",padding:`${i.spacing.sm}px ${i.spacing.md}px`,gap:i.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,g.Y)(o.FileDocumentIcon,{}),(0,g.Y)(a.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[t.length>0?(0,g.Y)(Ke,{css:Ve,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,g.Y)("span",{css:We,children:`${e}: ${t}`},e))),children:(0,g.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:Ue,children:["+",t.length-1]})}):null]})]})}function qe({text:e,metadata:t}){const[s,n]=(0,r.useState)(!1),i=(0,c.g_)(t);return s?(0,g.Y)(Pe,{text:e,metadataTags:i,setExpanded:n}):(0,g.Y)(Je,{text:e,metadataTags:i,setExpanded:n})}var Ge={name:"s5xdrg",styles:"display:flex;align-items:center"},Ze={name:"s5xdrg",styles:"display:flex;align-items:center"};function Xe({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:s}=(0,a.u)();return(0,g.FD)(o.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,g.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,g.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,g.Y)("div",{css:Ge,children:(0,g.Y)(o.TextBoxIcon,{css:(0,n.AH)({fontSize:s.typography.fontSizeLg},"")})})})}),(0,g.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,g.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,g.Y)("div",{css:Ze,children:(0,g.Y)(o.MIcon,{css:(0,n.AH)({fontSize:s.typography.fontSizeLg},"")})})})})]})}var Qe={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function et({activeSpan:e,className:t,searchFilter:s,activeMatch:i}){const{theme:d}=(0,a.u)(),[p,m]=(0,r.useState)(!0),h=(0,r.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),f=e.outputs,v=h.length>0,x=!(0,u.isNil)(i)&&i.span.key===e.key,y=x&&"outputs"===i.section;return(0,g.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,g.Y)(Ee,{sectionKey:"input",css:(0,n.AH)({marginBottom:d.spacing.sm},""),title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:h.map((({key:e,value:t},n)=>(0,g.Y)(ye,{title:e,data:t,searchFilter:s,activeMatch:i,containsActiveMatch:x&&"inputs"===i.section&&i.key===e},e||n)))})}),(0,g.Y)(Ee,{sectionKey:"output",title:(0,g.FD)("div",{css:Qe,children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:d.spacing.sm},""),children:[(0,g.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,g.Y)(o.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,g.Y)(Xe,{shouldRenderMarkdown:p,setShouldRenderMarkdown:m})]}),children:p&&!y?(0,g.Y)("div",{css:(0,n.AH)({border:`1px solid ${d.colors.border}`,borderRadius:d.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,g.Y)("div",{css:(0,n.AH)({borderBottom:t!==f.length-1?`1px solid ${d.colors.border}`:""},""),children:(0,g.Y)(qe,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,g.Y)("div",{css:(0,n.AH)({border:`1px solid ${d.colors.border}`,borderRadius:d.legacyBorders.borderRadiusMd,padding:d.spacing.md},""),children:(0,g.Y)(ye,{title:"",data:JSON.stringify(f,null,2),searchFilter:s,activeMatch:i,containsActiveMatch:x&&"outputs"===i.section})})})]})}function tt({activeSpan:e,className:t,searchFilter:s,activeMatch:r}){const{theme:i}=(0,a.u)();return!(0,u.isNil)(e)&&(0,c.vl)(e)?(0,g.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,g.Y)(et,{activeSpan:e,className:t,searchFilter:s,activeMatch:r})}):(0,g.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,g.Y)(Oe,{activeSpan:e,className:t,searchFilter:s,activeMatch:r})})}function st({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:r}=(0,a.u)(),{events:i}=e,d=!(0,u.isNil)(s)&&s.span.key===e.key;return Array.isArray(i)&&0!==i.length?(0,g.Y)("div",{css:(0,n.AH)({padding:r.spacing.md},""),children:i.map(((e,i)=>{const l=e.attributes,u="exception"===e.name?(0,g.FD)(g.FK,{children:[(0,g.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:r.spacing.sm},""),color:"danger"}),(0,g.Y)(a.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,g.Y)(Ee,{sectionKey:e.name,title:u,withBorder:!0,children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:Object.keys(l).map((n=>{const r=(0,c.Q0)(e.name,i,n);return(0,g.Y)(ye,{title:n,data:JSON.stringify(l[n],null,2),searchFilter:t,activeMatch:s,containsActiveMatch:d&&"events"===s.section&&s.key===r,initialRenderMode:B.cC.TEXT},r)}))})},`${e.name}-${i}`):null}))}):(0,g.Y)("div",{css:(0,n.AH)({marginTop:r.spacing.md},""),children:(0,g.Y)(o.Empty,{description:(0,g.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}function nt({count:e}){const{theme:t}=(0,a.u)();return(0,g.Y)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,g.Y)("span",{css:(0,n.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var rt={name:"4zleql",styles:"display:block"},it={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const at=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:s}=N();return(0,g.Y)(o.SegmentedControlGroup,{css:rt,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,g.Y)(o.SegmentedControlButton,{value:!0,disabled:!s,icon:(0,g.Y)(o.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:it,children:!e&&(0,g.Y)(l.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var ot=s(26955),lt=s(27288),dt=s(77020);const ct=250,ut=(e,t=new Date)=>{const s=Math.max(0,Math.floor((t.getTime()-e)/1e3));let n=Math.floor(s/31536e3);return n>=1?(0,g.Y)(l.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(s/2592e3),n>=1?(0,g.Y)(l.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(s/86400),n>=1?(0,g.Y)(l.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(s/3600),n>=1?(0,g.Y)(l.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(s/60),n>=1?(0,g.Y)(l.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,g.Y)(l.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:s}})))))},pt=({formValue:e,dataType:t,isFeedback:s})=>s?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var mt=s(39416);const gt=fetch;function ht(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}const ft=async(e,t="GET",s)=>{const n=await gt(e,{method:t,body:ht(s),headers:s?{"Content-Type":"application/json"}:{}});if(!n.ok){const e=(0,mt.a$)(n);if(e){try{const t=(await n.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return n.json()},vt=({payload:e})=>ft(`/ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`,"POST",e),xt=({assessmentName:e,spanId:t,traceId:s,setExpanded:i})=>{const d=(0,l.tz)(),p=(0,lt.jE)(),{theme:m}=(0,a.u)(),[h,f]=(0,r.useState)(""),[v,x]=(0,r.useState)("feedback"),[y,Y]=(0,r.useState)("boolean"),[S,A]=(0,r.useState)(!0),[w,T]=(0,r.useState)(""),[M,D]=(0,r.useState)(null),{mutate:I,isLoading:k}=(0,dt.n)({mutationFn:e=>vt({payload:e}),onSuccess:()=>{p.invalidateQueries({queryKey:[c.BS,s]})},onError:e=>{(0,c.ij)(d.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{i(!1)}}),C=!(0,u.isNil)(e),F=(0,r.useCallback)((async()=>{var n;if("json"===y)try{JSON.parse(S)}catch(a){return void D((0,g.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}const r=pt({formValue:S,dataType:y,isFeedback:"feedback"===v}),i={assessment:{assessment_name:C?e:h,trace_id:s,source:{source_type:"HUMAN",source_id:null!==(n=(0,ot.w)())&&void 0!==n?n:""},span_id:t,rationale:w,...r}};I(i)}),[y,S,v,C,e,h,s,t,w,I]);return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs,marginTop:m.spacing.sm,border:`1px solid ${m.colors.border}`,padding:m.spacing.sm,borderRadius:m.borders.borderRadiusSm},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,g.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:v,disabled:k,onChange:e=>x(e.target.value),children:[(0,g.Y)(o.SimpleSelectOption,{value:"feedback",children:(0,g.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,g.Y)(o.SimpleSelectOption,{value:"expectation",children:(0,g.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),C?(0,g.Y)(a.T.Text,{children:e}):(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-name-input",value:h,disabled:k,onKeyDown:e=>e.stopPropagation(),onChange:e=>f(e.target.value)}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,g.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:y,disabled:k,onChange:e=>{Y(e.target.value),D(null)},children:["expectation"===v&&(0,g.Y)(o.SimpleSelectOption,{value:"json",children:(0,g.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,g.Y)(o.SimpleSelectOption,{value:"string",children:(0,g.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,g.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,g.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,g.Y)(o.SimpleSelectOption,{value:"number",children:(0,g.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),"json"===y&&(0,g.FD)(g.FK,{children:[(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},validationState:M?"error":void 0,disabled:k}),M&&(0,g.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},disabled:k,allowClear:!0}),"boolean"===y&&(0,g.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:S,disabled:k,onChange:e=>{A(e.target.value),D(null)},children:[(0,g.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,g.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value?Number(e.target.value):""),D(null)},type:"number",disabled:k,allowClear:!0}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:k,onKeyDown:e=>e.stopPropagation(),onChange:e=>T(e.target.value)}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:m.spacing.xs},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:k,onClick:()=>i(!1),children:(0,g.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,g.Y)(a.B,{css:(0,n.AH)({marginLeft:m.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:F,loading:k,children:(0,g.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})},yt=({title:e,assessmentName:t,spanId:s,traceId:n})=>{const[i,l]=(0,r.useState)(!1);return(0,g.FD)("div",{children:[(0,g.Y)(a.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,g.Y)(o.PlusIcon,{}),onClick:()=>l(!0),children:e}),i&&(0,g.Y)(xt,{assessmentName:t,spanId:s,traceId:n,setExpanded:l})]})},bt=({assessment:e,setIsEditing:t,setShowDeleteModal:s})=>{var n;const r="feedback"in e,i=null!==(n=(0,ot.w)())&&void 0!==n?n:"",c=(0,d.nX)(),u=i===e.source.source_id||r&&"HUMAN"!==e.source.source_type,p=c&&u&&t;return(0,g.FD)(o.DropdownMenu.Root,{children:[(0,g.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,g.Y)(o.OverflowIcon,{}),size:"small"})}),(0,g.FD)(o.DropdownMenu.Content,{minWidth:100,children:[p&&(0,g.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,g.Y)(o.DropdownMenu.IconWrapper,{children:(0,g.Y)(o.PencilIcon,{})}),(0,g.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,g.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>s(!0),children:[(0,g.Y)(o.DropdownMenu.IconWrapper,{children:(0,g.Y)(o.TrashIcon,{})}),(0,g.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},Yt=({assessment:e,isModalVisible:t,setIsModalVisible:s})=>{const n=(0,l.tz)(),i=(0,lt.jE)(),{mutate:a,isLoading:o}=(0,dt.n)({mutationFn:()=>(({traceId:e,assessmentId:t})=>ft(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"DELETE"))({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{i.invalidateQueries({queryKey:[c.BS,e.trace_id]})},onError:e=>{(0,c.ij)(n.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{s(!1)}}),d=(0,r.useCallback)((()=>{a()}),[a]);return(0,g.Y)(Ae.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:d,okButtonProps:{danger:!0,loading:o},okText:(0,g.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{s(!1)},cancelText:(0,g.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,g.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,g.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})},St=({assessment:e,onSuccess:t,onError:s,onSettled:n})=>{const r=(0,l.tz)(),i=(0,lt.jE)(),{mutate:a,isLoading:o}=(0,dt.n)({mutationFn:t=>(({traceId:e,assessmentId:t,payload:s})=>ft(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"PATCH",s))({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,c.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:()=>{i.invalidateQueries({queryKey:[c.BS,e.trace_id]}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{updateAssessmentMutation:a,isLoading:o}},At=({assessment:e,onSuccess:t,onSettled:s,onCancel:i})=>{var d;const p="feedback"in e,m=(e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value)(e),h=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(s){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(m,p),f=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(m),v=null!==(d=(0,ot.w)())&&void 0!==d?d:"",{theme:x}=(0,a.u)(),[y,Y]=(0,r.useState)(h),[S,A]=(0,r.useState)(f),[w,T]=(0,r.useState)(e.rationale),[M,D]=(0,r.useState)(null),{updateAssessmentMutation:I,isLoading:k}=St({assessment:e,onSuccess:t,onSettled:s}),{overrideAssessmentMutation:C,isLoading:F}=(({traceId:e,onSuccess:t,onError:s,onSettled:n})=>{const r=(0,l.tz)(),i=(0,lt.jE)(),{mutate:a,isLoading:o}=(0,dt.n)({mutationFn:({oldAssessment:e,value:t,rationale:s})=>{var n;const r={...e,...t,rationale:s,source:{source_id:null!==(n=(0,ot.w)())&&void 0!==n?n:"",source_type:"HUMAN"},overrides:e.assessment_id},i={assessment:(0,u.omit)(r,"assessment_id","create_time","last_update_time","overriddenAssessments")};return vt({payload:i})},onError:e=>{(0,c.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:()=>{i.invalidateQueries({queryKey:[c.BS,e]}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{overrideAssessmentMutation:a,isLoading:o}})({traceId:e.trace_id,onSuccess:t,onSettled:s}),H=k||F,N=(0,r.useCallback)((async()=>{if("json"===y)try{JSON.parse(S)}catch(s){return void D((0,g.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=pt({formValue:S,dataType:y,isFeedback:p});if(v!==e.source.source_id&&p)C({oldAssessment:e,value:t,...w?{rationale:w}:{}});else{const e={assessment:{...t,rationale:w},update_mask:(p?"feedback":"expectation")+",rationale"};I(e)}}),[y,S,p,v,e,w,I,C]);return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs,marginTop:x.spacing.sm,border:`1px solid ${x.colors.border}`,padding:x.spacing.sm,borderRadius:x.borders.borderRadiusSm},""),children:[(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,g.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:y,disabled:H,onChange:e=>{Y(e.target.value),D(null)},children:[!p&&(0,g.Y)(o.SimpleSelectOption,{value:"json",children:(0,g.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,g.Y)(o.SimpleSelectOption,{value:"string",children:(0,g.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,g.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,g.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,g.Y)(o.SimpleSelectOption,{value:"number",children:(0,g.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===y&&(0,g.FD)(g.FK,{children:[(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},validationState:M?"error":void 0,disabled:H}),M&&(0,g.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},disabled:H,allowClear:!0}),"boolean"===y&&(0,g.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:S,disabled:H,onChange:e=>{A(e.target.value),D(null)},children:[(0,g.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,g.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value?Number(e.target.value):""),D(null)},type:"number",disabled:H,allowClear:!0}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>T(e.target.value)}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:x.spacing.xs},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:H,onClick:i,children:(0,g.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,g.Y)(a.B,{css:(0,n.AH)({marginLeft:x.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:N,loading:H,children:(0,g.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var wt={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},Tt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Mt=({objectKey:e,value:t})=>{const{theme:s}=(0,a.u)(),r=(0,u.isString)(t)?t:JSON.stringify(t);return(0,g.Y)(Ae.T,{content:r,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,g.Y)(o.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:wt,children:(0,g.FD)(a.T.Text,{css:Tt,children:[e&&(0,g.FD)(a.T.Text,{bold:!0,css:(0,n.AH)({marginRight:s.spacing.xs},""),children:[e,":"]}),r]})})})},Dt=({node:e})=>{var t;const{theme:s}=(0,a.u)(),{setSelectedNode:r,setActiveView:i,setShowTimelineTreeGantt:o}=N(),l=(0,c.N7)(e)>0;return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",marginRight:s.spacing.xs,gap:s.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?s.colors.actionDangerDefaultTextDefault:s.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{r(e),i("detail"),o(!1)},children:[(0,g.Y)(we.P,{hasException:l,type:(0,c.tC)(null!==(t=e.type)&&void 0!==t?t:B.UG.UNKNOWN)}),(0,g.Y)(a.T.Text,{color:l?"error":"primary",css:(0,n.AH)({marginLeft:s.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};const It=e=>Array.isArray(e)?e.map(((e,t)=>(0,g.Y)(Mt,{value:e},t))):(0,u.isObject)(e)?Object.entries(e).map((([e,t])=>(0,g.Y)(Mt,{objectKey:e,value:t},e))):(0,g.Y)(Mt,{value:e});var kt={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Ct={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Ft=({expectation:e})=>{const{theme:t}=(0,a.u)(),[s,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),{nodeMap:c,activeView:u}=N(),p=e.span_id?c[e.span_id]:null,m="summary"===u&&p,h=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation);return(0,g.FD)("div",{css:(0,n.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,g.FD)("div",{css:kt,children:[(0,g.Y)(a.T.Text,{bold:!0,css:Ct,children:e.assessment_name}),(0,g.Y)(bt,{assessment:e,setIsEditing:i,setShowDeleteModal:d}),(0,g.Y)(Yt,{assessment:e,isModalVisible:o,setIsModalVisible:d})]}),s?(0,g.Y)(At,{assessment:e,onSuccess:()=>i(!1),onCancel:()=>i(!1)}):It(h),m&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,g.Y)(Dt,{node:p})]})]})};var Ht={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const Nt=({jsonValue:e})=>{const{theme:t}=(0,a.u)();if(!e||'""'===e)return null;let s;try{s=JSON.parse(e)}catch(d){s=e}let r="default",i=JSON.stringify(s,null,2);return"yes"===s?(r="lime",i=(0,g.FD)(g.FK,{children:[(0,g.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===s?(r="coral",i=(0,g.FD)(g.FK,{children:[(0,g.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof s?i=s:null===s?(r="coral",i=(0,g.FD)(g.FK,{children:[(0,g.Y)(a.l,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===s?(r="lime",i=(0,g.FD)(g.FK,{children:[(0,g.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===s&&(r="coral",i=(0,g.FD)(g.FK,{children:[(0,g.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:i,children:(0,g.Y)(o.Tag,{css:(0,n.AH)({display:"inline-flex",maxWidth:"100%",minWidth:t.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:r,children:(0,g.Y)("span",{css:Ht,children:i})})})},Rt=({source:e})=>{const{theme:t}=(0,a.u)();return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,g.Y)("span",{css:(0,n.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{css:(0,n.AH)({color:t.colors.blue500},""),children:e.source_id})})})})};var _t={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const Et=({renderConnector:e=!0,assessment:t,setIsEditing:s})=>{const{theme:i}=(0,a.u)(),[l,d]=(0,r.useState)(!1),c=(e=>{switch(e.source_type){case"HUMAN":return o.UserIcon;case"LLM_JUDGE":return o.SparkleIcon;default:return o.CodeIcon}})(t.source);return(0,g.FD)("div",{css:_t,children:[e&&(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",left:-1,top:0,width:10,height:i.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:i.borders.borderRadiusMd,borderBottom:`1px solid ${i.colors.border}`,borderLeft:`1px solid ${i.colors.border}`},"")}),(0,g.Y)(c,{size:i.typography.fontSizeSm,css:(0,n.AH)({padding:2,backgroundColor:i.colors.actionIconBackgroundHover,borderRadius:i.borders.borderRadiusFull},"")}),(0,g.Y)(Rt,{source:t.source}),(0,g.FD)("div",{css:(0,n.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:i.spacing.xs},""),children:[t.last_update_time&&(0,g.Y)(a.T.Text,{color:"secondary",size:"sm",css:(0,n.AH)({marginLeft:i.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:ut(new Date(t.last_update_time))}),(0,g.Y)(bt,{assessment:t,setIsEditing:s,setShowDeleteModal:d}),(0,g.Y)(Yt,{assessment:t,isModalVisible:l,setIsModalVisible:d})]})]})},Bt=({error:e})=>{const{theme:t}=(0,a.u)(),[s,i]=(0,r.useState)(!1);return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)(o.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)("span",{children:e.error_message}),e.stack_trace&&(0,g.Y)(a.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>i(!0),children:(0,g.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,g.Y)(Ae.d,{title:(0,g.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:s,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>i(!1),children:(0,g.Y)(ye,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:B.cC.TEXT})})]})};var jt={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const zt=({feedback:e})=>{const{theme:t}=(0,a.u)(),s=e.feedback.value;return(0,g.FD)("div",{css:jt,children:[(0,g.Y)(Et,{renderConnector:!1,assessment:e}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,u.isNil)(e.feedback.error)?(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,g.Y)("div",{children:(0,g.Y)(Nt,{jsonValue:JSON.stringify(s)})})]}):(0,g.Y)(Bt,{error:e.feedback.error}),e.rationale&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",css:(0,n.AH)({marginTop:t.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,g.Y)(ee,{children:e.rationale})]})]})]})},Ot=({isModalVisible:e,setIsModalVisible:t,feedback:s})=>{const n=(0,r.useMemo)((()=>(e=>{const t=new Set,s=[];let n=e;for(;n&&!t.has(n.assessment_id);)t.add(n.assessment_id),s.push(n),n=n.overriddenAssessment;return s})(s)),[s]);return(0,g.Y)(Ae.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,g.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:n.map((e=>"feedback"in e?(0,g.Y)(zt,{feedback:e},e.assessment_id):null))})};var Lt={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},Kt={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"};const $t=({feedback:e})=>{const[t,s]=(0,r.useState)(!1),{theme:i}=(0,a.u)(),{nodeMap:o,activeView:d}=N(),c=e.feedback.value,p=e.span_id?o[e.span_id]:null,m="summary"===d&&p;return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginLeft:i.spacing.lg},""),children:[!(0,u.isNil)(e.feedback.error)&&(0,g.Y)(Bt,{error:e.feedback.error}),m&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,g.Y)(Dt,{node:p})]}),(0,u.isNil)(e.feedback.error)&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,g.Y)(Nt,{jsonValue:JSON.stringify(c)}),e.overriddenAssessment&&(0,g.FD)(g.FK,{children:[(0,g.Y)("span",{onClick:()=>s(!0),children:(0,g.Y)(a.T.Text,{css:Lt,color:"secondary",children:(0,g.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,g.Y)(Ot,{isModalVisible:t,setIsModalVisible:s,feedback:e})]})]})]}),e.rationale&&(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,g.Y)("div",{css:Kt,children:(0,g.Y)(ee,{children:e.rationale})})]})]})},Pt=({feedback:e})=>{const{theme:t}=(0,a.u)(),[s,i]=(0,r.useState)(!1);return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,g.Y)(Et,{assessment:e,setIsEditing:i}),s?(0,g.Y)(At,{assessment:e,onSuccess:()=>i(!1),onCancel:()=>i(!1)}):(0,g.Y)($t,{feedback:e})]})};const Vt=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,g.Y)(o.UserIcon,{css:t});case"LLM_JUDGE":return(0,g.Y)(o.SparkleIcon,{css:t});case"CODE":return(0,g.Y)(o.CodeIcon,{css:t});default:return null}};var Wt={name:"ti75j2",styles:"margin:0"};const Ut=({feedbacks:e})=>{const{theme:t}=(0,a.u)();if(e.length<2)return null;const s=(0,u.countBy)(e,(e=>e.source.source_type));return(0,g.Y)("div",{css:(0,n.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(s).map((([e,s])=>(0,g.Y)(o.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:Wt,children:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[Vt(e),(0,g.Y)(a.T.Text,{children:s})]})},e)))})};var Jt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},qt={name:"ozd7xs",styles:"flex-shrink:0"},Gt={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Zt=({jsonValue:e,feedbacks:t})=>{const{theme:s}=(0,a.u)(),[i,l]=(0,r.useState)(!1);return(0,g.FD)("div",{css:Jt,children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center"},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:qt,size:"small",icon:i?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>l(!i)}),(0,g.Y)(Nt,{jsonValue:e}),(0,g.Y)(Ut,{feedbacks:t})]}),i&&(0,g.Y)("div",{css:Gt,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,g.Y)(Pt,{feedback:e},e.assessment_id)))})]})};var Xt={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Qt={name:"ozd7xs",styles:"flex-shrink:0"};const es=({name:e,valuesMap:t,traceId:s,activeSpanId:i})=>{const{theme:l}=(0,a.u)(),d=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[c,p]=(0,r.useState)(!1),m=Object.values(t).flat().some((e=>!(0,u.isNil)(e.feedback.error)));return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},""),children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},""),children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},""),children:[(0,g.Y)(a.T.Text,{bold:!0,css:Xt,children:d}),m&&(0,g.Y)(a.l,{css:Qt,color:"danger"})]}),(0,g.Y)(Ae.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,n.AH)({flexShrink:0,marginRight:-l.spacing.xs},""),size:"small",icon:(0,g.Y)(o.PlusIcon,{}),onClick:()=>p(!0)})})]}),Object.entries(t).map((([e,t])=>(0,g.Y)(Zt,{jsonValue:e,feedbacks:t},e))),c&&(0,g.Y)(xt,{assessmentName:e,spanId:i,traceId:s,setExpanded:p})]})};var ts={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const ss=({assessments:e,traceId:t,activeSpanId:s})=>{const{theme:i}=(0,a.u)(),{setAssessmentsPaneExpanded:o}=N(),[d,c]=(0,r.useMemo)((()=>(0,u.partition)(e,(e=>"feedback"in e))),[e]),p=(0,r.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let s=null;""!==e.feedback.value&&(s=JSON.stringify(e.feedback.value));const{assessment_name:n}=e;t[n]||(t[n]={});const r=t[n];(0,u.isNil)(s)||(r[s]||(r[s]=[]),r[s].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(d)),[d]),m=c.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,g.FD)("div",{"data-testid":"assessments-pane",css:(0,n.AH)({display:"flex",flexDirection:"column",padding:i.spacing.sm,paddingTop:i.spacing.xs,height:"100%",borderLeft:`1px solid ${i.colors.border}`,overflowY:"scroll",minWidth:ct,width:"100%",boxSizing:"border-box"},""),children:[(0,g.FD)("div",{css:ts,children:[(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginBottom:i.spacing.sm},""),bold:!0,children:(0,g.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),o&&(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,g.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,g.Y)(a.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,g.Y)(a.C,{}),onClick:()=>o(!1)})})]}),p.map((([e,n])=>(0,g.Y)(es,{name:e,valuesMap:n,traceId:t,activeSpanId:s},e))),m.length>0&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,n.AH)({marginBottom:i.spacing.sm},""),children:(0,g.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginBottom:i.spacing.sm},""),children:m.map((e=>(0,g.Y)(Ft,{expectation:e},e.assessment_id)))})]}),(0,g.Y)(yt,{title:"Add new assessment",spanId:s,traceId:t})]})};function ns({activeSpan:e,searchFilter:t,activeMatch:s,activeTab:i,setActiveTab:d}){const{theme:p}=(0,a.u)(),[m,h]=(0,r.useState)(500),f={flex:1,marginTop:-p.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:y}=N();if((0,u.isNil)(e))return(0,g.Y)(o.Empty,{description:"Please select a span to view more information"});const b=(0,c.N7)(e),Y=b>0,S=(0,g.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${p.colors.border}`,minWidth:200,position:"relative"},""),value:i,onValueChange:e=>d(e),children:[(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",right:v?p.spacing.xs:p.spacing.md,top:p.spacing.xs},""),children:(0,g.Y)(at,{})}),(0,g.FD)(o.Tabs.List,{css:(0,n.AH)({padding:0,paddingLeft:p.spacing.md,paddingRight:p.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,g.Y)(o.Tabs.Trigger,{value:"chat",children:(0,g.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),(0,g.Y)(o.Tabs.Trigger,{value:"content",children:(0,g.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,g.Y)(o.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,g.FD)(o.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,g.Y)(nt,{count:b})]})]}),e.chatMessages&&(0,g.Y)(o.Tabs.Content,{css:f,value:"chat",children:(0,g.Y)(Be,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,g.Y)(o.Tabs.Content,{css:f,value:"content",children:(0,g.Y)(tt,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,g.Y)(o.Tabs.Content,{css:f,value:"attributes",children:(0,g.Y)(be,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,g.Y)(o.Tabs.Content,{css:f,value:"events",children:(0,g.Y)(st,{activeSpan:e,searchFilter:t,activeMatch:s})})]});return y&&v?(0,g.Y)(x,{initialRatio:.7,paneWidth:m,setPaneWidth:h,leftChild:S,leftMinWidth:250,rightChild:(0,g.Y)(ss,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:ct}):S}const rs=r.memo(ns),is=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:s}=(0,a.u)();return(0,g.FD)(a.ax.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,g.Y)(a.ax.Trigger,{asChild:!0,children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,g.Y)(o.FilterIcon,{}),size:"small",children:(0,g.Y)(l.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,g.Y)(a.ax.Content,{align:"start",children:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{bold:!0,children:(0,g.Y)(l.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,g.Y)(a.T.Text,{color:"secondary",children:(0,g.Y)(l.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([r,i])=>{const l=(0,g.Y)(we.P,{type:(0,c.tC)(r)});return(0,g.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${r}-${!i}`,style:{width:"100%"},isChecked:i,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[r]:!i}}),children:[l,(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginLeft:s.spacing.xs},""),children:(0,c.LS)(r)})]},r)})),(0,g.Y)(a.T.Text,{color:"secondary",children:(0,g.Y)(l.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,g.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginRight:s.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,g.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,g.Y)(l.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,g.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginRight:s.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,g.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,g.Y)(l.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},as=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:s,setSpanFilterState:r})=>{const{theme:i}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({padding:`${i.spacing.xs}px ${i.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${i.colors.border}`,boxSizing:"border-box",paddingLeft:i.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,g.Y)(a.T.Text,{bold:!0,children:(0,g.Y)(l.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[(0,g.Y)(is,{spanFilterState:s,setSpanFilterState:r}),(0,g.FD)(o.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,g.Y)(o.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,g.Y)(l.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,g.Y)(o.ListBorderIcon,{})}),value:!1}),(0,g.Y)(o.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,g.Y)(l.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,g.Y)(o.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},os=({active:e})=>{const{theme:t}=(0,a.u)(),s=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",left:"100%",bottom:0,width:9,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${s}`,borderRight:`1px solid ${s}`,zIndex:M},"")})},ls=({active:e})=>{const{theme:t}=(0,a.u)(),s=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",left:"50%",top:0,width:8,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${s}`,borderLeft:`1px solid ${s}`,zIndex:e?T:M},"")})},ds=({active:e})=>{const{theme:t}=(0,a.u)(),s=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",width:8,left:"50%",height:32,borderLeft:`1px solid ${s}`,boxSizing:"border-box",zIndex:e?T:M},"")})},cs=({isActiveSpan:e,isInActiveChain:t,linesToRender:s,hasChildren:r,isExpanded:i})=>0===s.length?(0,g.Y)("div",{css:(0,n.AH)({width:0,height:32,boxSizing:"border-box",position:"relative"},""),children:r&&(0,g.Y)(os,{active:t&&!e})}):(0,g.Y)(g.FK,{children:s.map((({shouldRender:a,isActive:o},l)=>(0,g.FD)("div",{css:(0,n.AH)({width:16,height:32,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,g.Y)(ds,{active:o}),l===s.length-1&&(0,g.FD)(g.FK,{children:[(0,g.Y)(ls,{active:t}),r&&i&&(0,g.Y)(os,{active:t&&!e})]})]},l)))});var us={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ps=({span:e,children:t})=>{var s;const{theme:r}=(0,a.u)(),i=(0,c.tC)(null!==(s=e.type)&&void 0!==s?s:B.UG.UNKNOWN),o=r.isDarkMode?r.colors.grey800:r.colors.grey100,d=r.isDarkMode?r.colors.grey500:r.colors.grey350;return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,g.FD)("div",{css:us,children:[(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:r.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,g.Y)(we.P,{type:i,isInTooltip:!0}),(0,g.Y)("span",{css:(0,n.AH)({color:o},""),children:e.title}),(0,g.Y)("span",{css:(0,n.AH)({marginLeft:r.spacing.xs,color:d,fontSize:r.typography.fontSizeSm},""),children:k(e.end-e.start)})]}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",color:o},""),children:[(0,g.Y)(l.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",k(e.start)," | ",(0,g.Y)(l.sA,{id:"q90jVU",defaultMessage:"End:"})," ",k(e.end)]})]}),side:"right",maxWidth:700,children:t})};var ms={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},gs={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const hs=({node:e,selectedKey:t,expandedKeys:s,setExpandedKeys:r,traceStartTime:i,traceEndTime:l,onSelect:d,linesToRender:u})=>{var p,m;const h=s.has(e.key),{theme:f}=(0,a.u)(),v=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,{setAssessmentsPaneExpanded:x}=N(),y=t===e.key,b=C(e,String(t)),Y=b>-1,S=(0,c.N7)(e)>0,A=y?f.colors.actionDefaultBackgroundHover:"transparent";return(0,g.FD)(g.FK,{children:[(0,g.Y)(ps,{span:e,children:(0,g.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:A,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,g.FD)("div",{css:ms,children:[v?(0,g.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:h?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:t=>{t.stopPropagation();const n=new Set(s);h?n.delete(e.key):n.add(e.key),r(n)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,g.Y)("div",{css:(0,n.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,g.Y)(cs,{isActiveSpan:y,isInActiveChain:Y,linesToRender:u,hasChildren:v,isExpanded:h}),(0,g.Y)("span",{css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${b>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:T},""),children:e.icon}),(0,g.Y)(a.T.Text,{color:S?"error":"primary",css:gs,children:e.title}),e.assessments.length>0&&(0,g.FD)(o.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,n.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===x||void 0===x?void 0:x(!0),children:[(0,g.Y)(o.GavelIcon,{}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),h&&(null===(m=e.children)||void 0===m?void 0:m.map(((n,a)=>{var o,c;return(0,g.Y)(hs,{node:n,expandedKeys:s,setExpandedKeys:r,selectedKey:t,traceStartTime:i,traceEndTime:l,onSelect:d,linesToRender:u.concat({shouldRender:a<(null!==(o=null===(c=e.children)||void 0===c?void 0:c.length)&&void 0!==o?o:0)-1,isActive:a<b})},n.key)})))]})};var fs={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const vs=({node:e,selectedKey:t,leftOffset:s,width:i,onSelect:l,expandedKeys:d,setExpandedKeys:c})=>{var u;const{theme:p}=(0,a.u)(),m=(0,r.useRef)(null),h=(0,r.useRef)(null),f=t===e.key?p.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,x=d.has(e.key);return(0,r.useLayoutEffect)((()=>{if(!m.current||!h.current)return;Math.max(m.current.offsetWidth,h.current.offsetWidth)<i-p.spacing.sm?(m.current.style.display="inline",h.current.style.display="none"):(m.current.style.display="none",h.current.style.display="inline")}),[p.spacing.sm,i]),(0,g.Y)(ps,{span:e,children:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:p.spacing.xs,paddingRight:p.spacing.sm,paddingTop:p.spacing.xs,paddingBottom:p.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:p.colors.actionDefaultBackgroundHover},":active":{backgroundColor:p.colors.actionDefaultBackgroundPress},zIndex:T},""),onClick:()=>null===l||void 0===l?void 0:l(e),children:[v?(0,g.Y)(a.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:p.spacing.xs},""),icon:x?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:t=>{t.stopPropagation();const s=new Set(d);x?s.delete(e.key):s.add(e.key),c(s)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,g.Y)("div",{css:(0,n.AH)({width:24,marginRight:p.spacing.xs},"")}),(0,g.Y)("div",{css:(0,n.AH)({width:s,flexShrink:0},"")}),(0,g.Y)("div",{css:(0,n.AH)({position:"relative",width:i,height:p.typography.lineHeightBase,backgroundColor:p.colors.blue600,borderRadius:p.borders.borderRadiusSm,flexShrink:0},""),children:(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{ref:m,css:(0,n.AH)({marginLeft:p.spacing.xs,color:p.colors.white,display:"none"},""),children:e.title})})}),(0,g.FD)("div",{css:fs,children:[(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{ref:h,css:(0,n.AH)({marginLeft:p.spacing.xs,color:p.colors.textPrimary},""),children:e.title})}),(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginLeft:p.spacing.xs},""),color:"secondary",children:k(e.end-e.start)})]})]},e.key)})};var xs={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},ys={name:"bjn8wh",styles:"position:relative"},bs={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const Ys=({nodes:e,selectedKey:t,onSelect:s,traceStartTime:i,traceEndTime:o,expandedKeys:l,setExpandedKeys:d})=>{var c,u;const{theme:p}=(0,a.u)(),h=(0,r.useRef)(null),f=null!==(c=null===(u=(0,m.wY)({ref:h}))||void 0===u?void 0:u.width)&&void 0!==c?c:0,v=(0,r.useMemo)((()=>function(e,t,s,n=60){const r=t-e;if(r<=0||s<=0)return[];const i=Math.floor(s/n);if(i<1)return[];const a=r/i,o=Math.pow(10,Math.floor(Math.log10(a))),l=a/o;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*o,u=t+2*c,p=[];for(let m=Math.ceil(e/c)*c;m<=u;m+=c)p.push(Number(m.toFixed(10)));return p}(i,o,f)),[o,i,f]),x=Math.min(...v),y=(v[v.length-1]+v[v.length-2])/2,b=v.slice(0,-1),Y=e=>function(e,t,s,n){return(e-t)/(s-t)*n}(e,x,y,f);return(0,g.FD)("div",{css:xs,children:[(0,g.Y)("div",{ref:h,css:(0,n.AH)({display:"flex",width:"100%",flexDirection:"row",height:p.typography.lineHeightBase,paddingLeft:32,paddingRight:p.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:p.colors.backgroundPrimary,zIndex:w},""),children:(0,g.Y)("div",{"data-testid":"time-marker-area",css:ys,children:b.map((e=>(0,g.Y)(a.T.Text,{css:(0,n.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:k(e)},e)))})}),(0,g.Y)("div",{css:(0,n.AH)({flex:1,pointerEvents:"none",zIndex:M},""),children:(0,g.Y)("div",{css:bs,children:b.map((e=>(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${p.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const n=Y(e.start),r=Y(e.end)-n;return(0,g.Y)(vs,{selectedKey:t,onSelect:s,node:e,leftOffset:n,width:r,expandedKeys:l,setExpandedKeys:d},e.key)}))]})};var Ss={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},As={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},ws={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},Ts={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const Ms=({rootNodes:e,selectedNode:t,setSelectedNode:s,traceStartTime:i,traceEndTime:o,expandedKeys:d,setExpandedKeys:c,spanFilterState:u,setSpanFilterState:p,className:m})=>{const{theme:h}=(0,a.u)(),f=(0,r.useCallback)((e=>{null===s||void 0===s||s(e)}),[s]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:x}=N(),y=(0,r.useMemo)((()=>((e,t)=>{const s=[],n=e=>{var r;e&&(s.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(n)))};return e.forEach(n),s})(e,d)),[e,d]),b=(0,r.useMemo)((()=>{var s;return(0,g.Y)("div",{css:Ss,children:v?(0,g.Y)(Ys,{nodes:y,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",onSelect:f,traceStartTime:i,traceEndTime:o,expandedKeys:d,setExpandedKeys:c}):e.map((e=>{var s;return(0,g.Y)(hs,{node:e,expandedKeys:d,setExpandedKeys:c,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",traceStartTime:i,traceEndTime:o,onSelect:f,linesToRender:[]},e.key)}))})}),[v,y,null===t||void 0===t?void 0:t.key,f,i,o,e,d,c]);return(0,g.Y)("div",{css:(0,n.AH)({height:"100%",borderRadius:h.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:m,children:(0,g.Y)("div",{css:As,children:(0,g.FD)("div",{css:ws,children:[(0,g.Y)(as,{showTimelineInfo:v,setShowTimelineInfo:x,spanFilterState:u,setSpanFilterState:p}),e.length>0?(0,g.Y)("div",{css:Ts,children:b}):(0,g.Y)("div",{css:(0,n.AH)({flex:1,display:"flex",justifyContent:"center",padding:h.spacing.md,paddingTop:h.spacing.lg},""),children:(0,g.Y)(l.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Ds={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Is={name:"82a6rk",styles:"flex:1"};const ks=({modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:i})=>{var o,l;const{theme:d}=(0,a.u)(),c=window.innerWidth<=768?.33:.25,p=(0,r.useRef)(null),[m,h]=(0,r.useState)(500),{rootNode:f,selectedNode:v,setSelectedNode:y,activeTab:b,setActiveTab:Y}=N(),{expandedKeys:w,setExpandedKeys:T}=((e={})=>{const[t,s]=(0,r.useState)((()=>{if(e.rootNodes){const t=(0,u.values)(I(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(t)}return new Set}));return{expandedKeys:t,setExpandedKeys:s}})({rootNodes:f?[f]:[],initialExpandDepth:A}),{matchData:M,searchFilter:D,setSearchFilter:k,spanFilterState:C,setSpanFilterState:H,filteredTreeNodes:R,handleNextSearchMatch:_,handlePreviousSearchMatch:B}=E({treeNode:f,selectedNode:v,setSelectedNode:y,setActiveTab:Y,setExpandedKeys:T,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,r.useLayoutEffect)((()=>{const e=(0,u.values)(I(R,A)).map((e=>e.key));T(new Set(e))}),[R,T]);const j=(0,r.useMemo)((()=>{const e=16*Math.max(...R.map(F))+7*d.spacing.lg;return Math.max(275,e)}),[R,d.spacing.lg]);return(0,g.FD)("div",{css:Ds,className:t,children:[(0,g.Y)("div",{css:(0,n.AH)({padding:d.spacing.xs,borderBottom:`1px solid ${d.colors.border}`},""),children:(0,g.Y)(S,{searchFilter:D,setSearchFilter:k,matchData:M,handleNextSearchMatch:_,handlePreviousSearchMatch:B})}),(0,g.Y)(x,{ref:p,initialRatio:c,paneWidth:m,setPaneWidth:h,leftChild:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:j},""),children:(0,g.Y)(Ms,{rootNodes:R,selectedNode:v,traceStartTime:null!==(o=null===f||void 0===f?void 0:f.start)&&void 0!==o?o:0,traceEndTime:null!==(l=null===f||void 0===f?void 0:f.end)&&void 0!==l?l:0,setSelectedNode:e=>{y(e),Y(null!==e&&void 0!==e&&e.chatMessages?"chat":"content"),(0,u.isString)(null===e||void 0===e?void 0:e.key)&&(null===i||void 0===i||i(null===e||void 0===e?void 0:e.key))},css:Is,expandedKeys:w,setExpandedKeys:T,spanFilterState:C,setSpanFilterState:H})}),leftMinWidth:j,rightChild:(0,g.Y)(rs,{activeSpan:v,searchFilter:D,activeMatch:M.match,activeTab:b,setActiveTab:Y}),rightMinWidth:500})]})},Cs=()=>(0,g.Y)(o.Empty,{title:(0,g.Y)(l.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,g.Y)(l.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,g.Y)(a.l,{})});var Fs={name:"15currb",styles:"display:flex;height:100%"},Hs={name:"82a6rk",styles:"flex:1"};var Ns=s(41261);const Rs=({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:s})=>{const n=[c.BS,e];return(0,Ns.I)({queryKey:n,queryFn:()=>(({traceId:e})=>ft(`/ajax-api/3.0/mlflow/traces/${e}`))({traceId:e}),onSuccess:e=>{t((t=>{var s,n;return{data:t.data,info:null!==(s=null===e||void 0===e||null===(n=e.trace)||void 0===n?void 0:n.trace_info)&&void 0!==s?s:{}}})),s(!0)},onError:()=>{s(!1)}})},_s=({title:e,tools:t})=>{const{theme:s}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,padding:s.spacing.sm,border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,g.Y)(a.T.Text,{css:(0,n.AH)({marginLeft:s.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,g.Y)(Se,{tool:e},e.function.name)))]})},Es=({title:e,documents:t})=>{const{theme:s}=(0,a.u)();return(0,g.FD)("div",{css:(0,n.AH)({backgroundColor:s.colors.backgroundPrimary,borderRadius:s.borders.borderRadiusSm,border:`1px solid ${s.colors.border}`},""),children:[e&&(0,g.Y)("div",{css:(0,n.AH)({padding:`${s.spacing.xs}px ${s.spacing.sm}px`,borderBottom:`1px solid ${s.colors.border}`},""),children:(0,g.Y)(a.T.Text,{bold:!0,children:e})}),t.map(((e,r)=>(0,g.Y)("div",{css:(0,n.AH)({borderBottom:r!==t.length-1?`1px solid ${s.colors.border}`:""},""),children:(0,g.Y)(qe,{text:e.page_content,metadata:e.metadata},r)},r)))]})},Bs=({title:e,value:t})=>{const{theme:s}=(0,a.u)(),[i,d]=(0,r.useState)(!1),c=t.length>400,u=!i&&t.length>400?t.slice(0,400)+"...":t,p=c?{":hover":{backgroundColor:s.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{css:(0,n.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,g.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${s.spacing.sm}px ${s.spacing.sm+s.spacing.xs}px`,...p},""),onClick:()=>d(!i),children:[(0,g.Y)(a.T.Text,{bold:!0,children:e}),c&&(i?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}))]}),(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.sm+s.spacing.xs,paddingRight:s.spacing.sm+s.spacing.xs,paddingTop:e?0:s.spacing.sm,paddingBottom:s.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,g.Y)(ee,{children:u}),c&&(0,g.Y)(a.T.Link,{onClick:()=>d(!i),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:i?(0,g.Y)(l.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},js=({title:e,data:t,renderMode:s})=>{const n=(0,r.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]),i=(0,u.isString)(n),a=(0,c.Hq)(n),o=Array.isArray(n)&&n.length>0&&(0,u.every)(n,c.PC),l=Array.isArray(n)&&n.length>0&&(0,u.every)(n,c.W0);return"json"===s?(0,g.Y)(ye,{title:e,data:t,initialRenderMode:B.cC.JSON}):"text"===s?(0,g.Y)(ye,{title:e,data:t,initialRenderMode:B.cC.TEXT}):i?(0,g.Y)(Bs,{title:e,value:n}):a&&a.length>0?(0,g.Y)(Re,{messages:a}):o?(0,g.Y)(_s,{title:e,tools:n}):l?(0,g.Y)(Es,{title:e,documents:n}):(0,g.Y)(ye,{title:e,data:t})},zs=({node:e})=>{var t;const{theme:s}=(0,a.u)(),r=(0,c.bn)(e),i=!e.parentId,l=r[0];return l?(0,g.Y)(Ee,{css:(0,n.AH)({marginBottom:i?s.spacing.sm:0},""),withBorder:i,sectionKey:l.name,title:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm},""),children:[(0,g.Y)(o.XCircleIcon,{color:"danger"}),(0,g.Y)(a.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.sm,paddingLeft:i?0:s.spacing.lg},""),children:Object.entries(null!==(t=l.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,g.Y)(js,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},l.name):null};var Os={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},Ls={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Ks={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const $s=({node:e,renderMode:t})=>{const{theme:s}=(0,a.u)(),[i,d]=(0,r.useState)(!1),u=(0,r.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),p=(0,r.useMemo)((()=>(0,c.g_)(e.outputs)),[e]),m=(0,c.bn)(e).length>0,h=u.length>0,f=p.length>0,{setSelectedNode:v,setActiveView:x,setShowTimelineTreeGantt:y}=N();return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,g.Y)("div",{css:(0,n.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,g.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:s.spacing.xs},""),icon:i?(0,g.Y)(o.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>d(!i),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,g.Y)("div",{css:(0,n.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${s.colors.border}`,width:12},""),children:(0,g.Y)("div",{css:(0,n.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:s.borders.borderRadiusMd,borderBottom:`2px solid ${s.colors.border}`,borderLeft:`2px solid ${s.colors.border}`},"")})}),(0,g.FD)("div",{css:Os,children:[(0,g.FD)("div",{css:Ls,children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,n.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,g.Y)(l.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,g.Y)(Dt,{node:e})}})}),(0,g.Y)("span",{onClick:()=>{v(e),x("detail"),y(!0)},children:(0,g.Y)(a.T.Text,{css:Ks,color:"secondary",children:k(e.end-e.start)})})]}),i&&(0,g.FD)("div",{children:[m&&(0,g.Y)(zs,{node:e}),h&&(0,g.Y)(Ee,{sectionKey:"input",title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:f?0:s.spacing.sm},""),children:u.map((({key:e,value:s},n)=>(0,g.Y)(js,{title:e,data:s,renderMode:t},e||n)))})}),f&&(0,g.Y)(Ee,{sectionKey:"output",title:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:s.spacing.sm},""),children:p.map((({key:e,value:s})=>(0,g.Y)(js,{title:e,data:s,renderMode:t},e)))})})]})]})]})},Ps=({rootNode:e,intermediateNodes:t})=>{const{theme:s}=(0,a.u)(),[i,d]=(0,r.useState)("default"),u=e.inputs,p=e.outputs,m=(0,c.bn)(e),h=t.length>0,f=m.length>0,v=(0,c.g_)(u),x=(0,c.g_)(p);return(0,g.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:s.spacing.md,paddingTop:s.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:s.spacing.sm},""),children:(0,g.FD)("div",{css:(0,n.AH)({display:"flex",gap:s.spacing.sm},""),children:[(0,g.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:i,size:"small",onChange:e=>d(e.target.value),children:[(0,g.Y)(o.SegmentedControlButton,{value:"default",children:(0,g.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,g.Y)(o.SegmentedControlButton,{value:"json",children:(0,g.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,g.Y)(at,{})]})}),f&&(0,g.Y)(zs,{node:e}),(0,g.Y)(Ee,{withBorder:!0,title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,n.AH)({marginBottom:h?0:s.spacing.md},""),sectionKey:"summary-inputs",children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:v.map((({key:e,value:t},s)=>(0,g.Y)(js,{title:e,data:t,renderMode:i},e||s)))})}),h&&t.map((e=>(0,g.Y)($s,{node:e,renderMode:i},e.key))),(0,g.Y)(Ee,{withBorder:!0,title:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,g.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:x.map((({key:e,value:t},s)=>(0,g.Y)(js,{title:e,data:t,renderMode:i},e||s)))})})]})},Vs=e=>{var t;return!!e.parentId&&([B.UG.AGENT,B.UG.RETRIEVER,B.UG.CHAT_MODEL,B.UG.TOOL,B.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:B.UG.UNKNOWN)||(0,c.N7)(e)>0)},Ws=({modelTrace:e})=>{const{theme:t}=(0,a.u)(),[s,i]=(0,r.useState)(500),{rootNode:d,nodeMap:c,assessmentsPaneEnabled:u,assessmentsPaneExpanded:p}=N(),m=(0,r.useMemo)((()=>Object.values(c).flatMap((e=>e.assessments))),[c]),h=(0,r.useMemo)((()=>{if(!d)return[];return D([d]).filter(Vs)}),[d]);return d?u&&p?(0,g.Y)(x,{initialRatio:.75,paneWidth:s,setPaneWidth:i,leftChild:(0,g.Y)(Ps,{rootNode:d,intermediateNodes:h}),rightChild:(0,g.Y)(ss,{assessments:m,traceId:d.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:ct}):(0,g.Y)(Ps,{rootNode:d,intermediateNodes:h}):(0,g.Y)("div",{css:(0,n.AH)({marginTop:t.spacing.lg},""),children:(0,g.Y)(o.Empty,{description:(0,g.Y)(l.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})})};var Us={name:"13y2nry",styles:"display:flex;flex-direction:column;height:100%;overflow:hidden"},Js={name:"1kyojz6",styles:"& > div:first-of-type{margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},qs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Gs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Zs=({modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:r})=>{const{theme:i}=(0,a.u)(),c=(0,d.wO)(),{activeView:u,setActiveView:p}=N();return c?(0,g.FD)(o.Tabs.Root,{componentId:"model-trace-explorer",value:u,onValueChange:e=>p(e),css:Js,children:[(0,g.FD)(o.Tabs.List,{css:(0,n.AH)({paddingLeft:i.spacing.md,flexShrink:0},""),children:[(0,g.Y)(o.Tabs.Trigger,{value:"summary",children:(0,g.Y)(l.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,g.Y)(o.Tabs.Trigger,{value:"detail",children:(0,g.Y)(l.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,g.Y)(o.Tabs.Content,{value:"summary",css:qs,children:(0,g.Y)(Ws,{modelTrace:e})}),(0,g.Y)(o.Tabs.Content,{value:"detail",css:Gs,children:(0,g.Y)(ks,{modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:r})})]}):(0,g.Y)("div",{css:Us,children:(0,g.Y)(ks,{modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:r})})},Xs=({children:e})=>(0,g.Y)(i.tH,{fallbackRender:Cs,children:e}),Qs=({modelTrace:e,className:t,initialActiveView:s="summary",selectedSpanId:n,onSelectSpan:i})=>{const[a,o]=(0,r.useState)(e),[l,d]=(0,r.useState)(!0),u=(0,c.MF)(e);return Rs({traceId:u,setModelTrace:o,setAssessmentsPaneEnabled:d}),(0,r.useEffect)((()=>{o(e)}),[u]),(0,g.Y)(Xs,{traceId:u,children:(0,g.Y)(R,{modelTrace:a,initialActiveView:s,selectedSpanIdOnRender:n,assessmentsPaneEnabled:l,children:(0,g.Y)(Zs,{modelTrace:a,className:t,selectedSpanId:n,onSelectSpan:i})})})};Qs.Skeleton=({label:e})=>{const{theme:t}=(0,a.u)();return(0,g.FD)("div",{css:Fs,children:[(0,g.FD)("div",{css:Hs,children:[(0,g.Y)("div",{css:(0,n.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,g.Y)(o.TitleSkeleton,{label:e})}),(0,g.FD)("div",{css:(0,n.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,g.Y)("div",{css:(0,n.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,g.Y)(o.TableSkeleton,{lines:5})}),(0,g.Y)("div",{css:(0,n.AH)({flex:2,padding:t.spacing.sm},""),children:(0,g.Y)(o.TableSkeleton,{lines:5})})]})]}),(0,g.Y)("div",{css:(0,n.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,g.Y)(o.TableSkeleton,{lines:12})})]})}},26955:function(e,t,s){s.d(t,{w:function(){return n}});const n=()=>"User"},36784:function(e,t,s){s.d(t,{n:function(){return d},u:function(){return c}});var n=s(9133),r=s(46932);const i=e=>(0,n.isObject)(e)&&(0,n.isString)((0,n.get)(e,"id"))&&(0,n.isString)((0,n.get)(e,"name"))&&(0,n.isString)((0,n.get)(e,"arguments")),a=e=>{if(!(0,n.isObject)(e))return!1;const t=(0,n.get)(e,"type");if(t){if("SystemMessage"===t)return(0,n.isString)((0,n.get)(e,"content"));if("UserMessage"===t)return(0,n.has)(e,"content")&&(0,n.has)(e,"source");if("AssistantMessage"===t)return(0,n.has)(e,"content")&&(0,n.has)(e,"source");if("FunctionMessage"===t)return(0,n.has)(e,"content")&&(0,n.has)(e,"source")}return!(!(0,n.has)(e,"source")||!["system","user","assistant","function"].includes((0,n.get)(e,"source")))&&(0,n.has)(e,"content")},o=e=>(0,n.isString)(e)?(0,r.ZI)({type:"message",content:e,role:"assistant"}):(0,n.isArray)(e)&&e.every(i)?{role:"assistant",tool_calls:e.map((e=>(0,r.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}})))}:null,l=e=>{if("SystemMessage"===e.type)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,n.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,n.isArray)(e.content)){const t=e.content.filter((e=>(0,n.isString)(e)||(0,n.isObject)(e)&&"text"===e.type)).map((e=>(0,n.isString)(e)?{type:"text",text:e}:e));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return o(e.content);if("FunctionMessage"===e.type)return(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,n.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,n.isArray)(e.content)){const t=e.content.filter((e=>(0,n.isString)(e))).map((e=>({type:"text",text:e})));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?o(e.content):"function"===e.source?(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},d=e=>{if((0,n.isNil)(e))return null;if((0,n.isArray)(e)&&e.length>0&&e.every(a))return(0,n.compact)(e.map(l));if((0,n.isObject)(e)&&"messages"in e){const t=e.messages;if((0,n.isArray)(t)&&t.length>0&&t.every(a))return(0,n.compact)(t.map(l))}return null},c=e=>{if((0,n.isNil)(e))return null;if((0,n.isArray)(e)&&e.length>0&&e.every(a))return(0,n.compact)(e.map(l));if((0,n.isObject)(e)&&"content"in e){const t=(0,r.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null}},38237:function(e,t,s){s.d(t,{Y:function(){return l},f:function(){return d}});var n=s(9133),r=s(46932);const i=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,s=e.image.format;let n;if("string"===typeof t)n=t;else{n=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${s}`};base64,${n}`}}}return null},a=e=>{let t=e.role;const s=[],n=[];let a;for(const d of e.content)if(d.toolUse){const e=d.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);n.push((0,r.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(d.toolResult){a=d.toolResult.toolUseId,t="tool";for(const e of d.toolResult.content){const t=i(e);t&&s.push(t)}}else{const e=i(d);e&&s.push(e)}let o="";s.length>0&&(o=s.map((e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"")).filter((e=>e.length>0)).join(" "));const l={role:t,content:o};return n.length>0&&(l.tool_calls=n),a&&(l.tool_call_id=a),l},o=e=>{if(!(0,n.isObject)(e))return!1;const t=(0,n.has)(e,"role")&&(0,n.isString)(e.role)&&["user","assistant","system"].includes(e.role),s=(0,n.has)(e,"content")&&(0,n.isArray)(e.content);return t&&s},l=e=>{if((0,n.isNil)(e))return null;if((0,n.isObject)(e)&&"messages"in e){const t=e.messages;if((0,n.isArray)(t)&&t.length>0&&t.every(o))return(0,n.compact)(t.map(a))}return null},d=e=>{if((0,n.isNil)(e))return null;if((0,n.isObject)(e)&&"output"in e){const t=e.output;if((0,n.isObject)(t)&&"message"in t){const e=t.message;if(o(e))return[a(e)]}}return null}},76901:function(e,t,s){s.d(t,{AG:function(){return c},a8:function(){return i},bS:function(){return a},m$:function(){return f},n_:function(){return p},xW:function(){return h}});var n=s(9133),r=s(46932);const i=e=>{var t;if(!e)return null;const s=null!==(t=e.messages)&&void 0!==t?t:e.input;return Array.isArray(s)&&0!==s.length&&s.every(r.I$)?(0,n.compact)(s.map(r.ZI)):null},a=e=>(0,r.x0)(e)?e.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):(0,r.in)(e)?e.choices.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):null,o=e=>!!((0,n.has)(e,"role")&&(0,n.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,n.isString)(e.content)||(0,n.isArray)(e.content)&&e.content.every((e=>(0,n.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type)))),l=e=>{if(!(0,n.isObject)(e))return!1;if("message"===(0,n.get)(e,"type"))return(0,r.I$)(e);if("function_call"===(0,n.get)(e,"type"))return(0,n.isString)((0,n.get)(e,"call_id"))&&(0,n.isString)((0,n.get)(e,"name"))&&(0,n.isString)((0,n.get)(e,"arguments"));if("function_call_output"===(0,n.get)(e,"type"))return(0,n.isString)((0,n.get)(e,"call_id"))&&(0,n.isString)((0,n.get)(e,"output"));if("image_generation_call"===(0,n.get)(e,"type")){const t=(0,n.get)(e,"output_format");return(0,n.isString)((0,n.get)(e,"result"))&&(0,n.isString)(t)&&["png","jpeg","webp"].includes(t)}return"reasoning"===(0,n.get)(e,"type")&&((0,n.has)(e,"id")&&(0,n.isArray)((0,n.get)(e,"summary")))},d=e=>{if((0,n.isString)(e.content)){const t=(0,r.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map((t=>((e,t)=>{const s=(0,n.get)(e,"text");if("input_text"===(0,n.get)(e,"type")&&(0,n.isString)(s))return(0,r.ZI)({type:"message",content:[{type:"text",text:s}],role:t});const i=(0,n.get)(e,"image_url");return"input_image"===(0,n.get)(e,"type")&&(0,n.isString)(i)?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:i}}],role:t}):null})(t,e.role))).filter((e=>null!==e))},c=e=>{const t=(0,n.get)(e,"input");if((0,n.isString)(t)){const e=(0,r.ZI)({type:"message",content:t,role:"user"});return e&&[e]}return(0,n.isArray)(t)&&t.every(o)?(0,n.compact)(t.flatMap(d)):null},u=e=>"message"===e.type?(0,r.ZI)(e):"function_call"===e.type?{role:"assistant",tool_calls:[(0,r.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null),p=e=>{if((0,n.isNil)(e))return null;const t=(0,n.get)(e,"output");return(0,n.isArray)(t)&&t.length>0&&t.every(l)?(0,n.compact)(t.map(u).filter(Boolean)):(0,n.isArray)(t)&&t.length>0&&t.every((e=>"response.output_item.done"===e.type&&l(e.item)))?(0,n.compact)(t.map((e=>u(e.item)))):null},m=e=>!!(0,n.isObject)(e)&&(!!((0,n.has)(e,"role")&&(0,n.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,n.get)(e,"type")?(0,n.isString)((0,n.get)(e,"call_id"))&&(0,n.isString)((0,n.get)(e,"name"))&&(0,n.isString)((0,n.get)(e,"arguments")):"function_call_output"===(0,n.get)(e,"type")&&((0,n.isString)((0,n.get)(e,"call_id"))&&(0,n.isString)((0,n.get)(e,"output"))))),g=e=>{if((0,n.has)(e,"role")&&(0,n.has)(e,"content")){if((0,n.isArray)(e.content)){const t=e.content.filter((e=>"output_text"===e.type&&(0,n.isString)(e.text))).map((e=>e.text)).join(" ");if(t)return(0,r.ZI)({...e,content:t})}return(0,r.ZI)(e)}if("function_call"===(0,n.get)(e,"type")){const t=(0,n.get)(e,"call_id"),s=(0,n.get)(e,"arguments"),i=(0,n.get)(e,"name");if((0,n.isString)(t)&&(0,n.isString)(s)&&(0,n.isString)(i))return{role:"assistant",tool_calls:[(0,r.CL)({id:t,function:{arguments:s,name:i}})]}}if("function_call_output"===(0,n.get)(e,"type")){const t=(0,n.get)(e,"call_id"),s=(0,n.get)(e,"output");if((0,n.isString)(t)&&(0,n.isString)(s))return{role:"tool",tool_call_id:t,content:s}}return null},h=e=>(0,n.isNil)(e)?null:(0,n.isArray)(e)&&e.length>0&&e.every(m)?(0,n.compact)(e.map(g)):null,f=e=>(0,n.isNil)(e)?null:(0,n.isArray)(e)&&e.length>0&&e.every(m)?(0,n.compact)(e.map(g)):null},79912:function(e,t,s){s.d(t,{H:function(){return d},W:function(){return l}});var n=s(9133),r=s(46932);const i=e=>{const t=(0,n.get)(e,"text");return"text"===(0,n.get)(e,"block_type")&&(0,n.isString)(t)},a=e=>{const t=(0,n.get)(e,"blocks"),s=(0,n.get)(e,"role");return(0,n.isString)(s)&&["assistant","system","user"].includes(s)&&(0,n.isArray)(t)&&t.every(i)},o=e=>(0,r.ZI)({role:e.role,content:e.blocks.map((e=>({type:"text",text:e.text})))}),l=e=>{if(!(e=>a((0,n.get)(e,"message")))(e))return null;const t=o(e.message);return t&&[t]},d=e=>(e=>{const t=(0,n.get)(e,"messages");return(0,n.isArray)(t)&&t.every(a)})(e)?(0,n.compact)(e.messages.map(o)):null},86494:function(e,t,s){s.d(t,{P:function(){return d}});var n=s(89555),r=s(59403),i=s(68048),a=s(70169),o=s(48563),l=s(50111);const d=({type:e=o.Dy.CONNECT,isInTooltip:t=!1,hasException:s=!1,isRootSpan:d=!1})=>{const{theme:c}=(0,r.u)();let u;d?u="ai":s&&(u="danger");const p={[o.Dy.MODELS]:(0,l.Y)(i.ModelsIcon,{color:u}),[o.Dy.DOCUMENT]:(0,l.Y)(i.FileDocumentIcon,{color:u}),[o.Dy.CONNECT]:(0,l.Y)(i.ConnectIcon,{color:u}),[o.Dy.CODE]:(0,l.Y)(i.CodeIcon,{color:u}),[o.Dy.FUNCTION]:(0,l.Y)(i.FunctionIcon,{color:u}),[o.Dy.NUMBERS]:(0,l.Y)(i.NumbersIcon,{color:u}),[o.Dy.SEARCH]:(0,l.Y)(a.S,{color:u}),[o.Dy.SORT]:(0,l.Y)(i.SortUnsortedIcon,{color:u}),[o.Dy.UNKNOWN]:(0,l.Y)(i.QuestionMarkIcon,{color:u}),[o.Dy.WRENCH]:(0,l.Y)(i.WrenchIcon,{color:u}),[o.Dy.AGENT]:(0,l.Y)(i.UserSparkleIcon,{color:u}),[o.Dy.CHAIN]:(0,l.Y)(i.ChainIcon,{color:u}),[o.Dy.USER]:(0,l.Y)(i.UserIcon,{color:u}),[o.Dy.SYSTEM]:(0,l.Y)(i.GearIcon,{color:u}),[o.Dy.SAVE]:(0,l.Y)(i.SaveIcon,{color:u})};let m=c.colors.actionDefaultIconDefault,g=c.colors.actionPrimaryIcon,h=c.colors.backgroundSecondary;switch(e){case o.Dy.SEARCH:m=c.colors.textValidationSuccess,g=c.colors.green500,h=c.isDarkMode?c.colors.green800:c.colors.green100;break;case o.Dy.MODELS:m=c.isDarkMode?c.colors.blue500:c.colors.turquoise,g=c.isDarkMode?c.colors.turquoise:c.colors.blue500,h=c.isDarkMode?c.colors.blue800:c.colors.blue100;break;case o.Dy.WRENCH:m=c.isDarkMode?c.colors.red500:c.colors.red700,g=c.isDarkMode?c.colors.red700:c.colors.red500,h=c.isDarkMode?c.colors.red800:c.colors.red100}return(0,l.FD)("div",{css:(0,n.AH)({position:"relative",width:c.general.iconSize,height:c.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:c.borders.borderRadiusSm,background:t?c.colors.tooltipBackgroundTooltip:h,color:t?g:m,svg:{width:c.general.iconFontSize,height:c.general.iconFontSize},flexShrink:0},""),children:[s&&(0,l.Y)("div",{css:(0,n.AH)({position:"absolute",top:-c.spacing.xs,right:-c.spacing.xs,height:c.spacing.sm,width:c.spacing.sm,borderRadius:c.borders.borderRadiusSm,backgroundColor:c.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),p[e]]})}},92151:function(e,t,s){s.d(t,{KF:function(){return d},pL:function(){return c},iU:function(){return M},Pn:function(){return D},DE:function(){return g},Sy:function(){return h},HD:function(){return S},oI:function(){return w},W3:function(){return T.W},a8:function(){return f.a8},bS:function(){return f.bS},AG:function(){return f.AG},n_:function(){return f.n_}});var n=s(9133),r=s(46932);const i=e=>{if((0,n.isNil)(e))return!1;if((0,n.has)(e,"type")){if("text"===e.type&&(0,n.has)(e,"text")&&(0,n.isString)(e.text))return!0;if("image"===e.type&&(0,n.has)(e,"source")&&(0,n.has)(e.source,"type")){if("base64"===e.source.type&&(0,n.has)(e.source,"media_type")&&(0,n.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,n.has)(e.source,"data")&&(0,n.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,n.has)(e.source,"url")&&(0,n.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,n.has)(e,"id")&&(0,n.has)(e,"name")&&(0,n.has)(e,"input"))return(0,n.isString)(e.id)&&(0,n.isString)(e.name)&&(0,n.isObject)(e.input);if("tool_result"===e.type&&(0,n.has)(e,"tool_use_id")&&(0,n.has)(e,"content"))return(0,n.isString)(e.tool_use_id)&&(0,n.isString)(e.content)}return!1},a=e=>{if(!(0,n.isObject)(e))return!1;const t=(0,n.has)(e,"role")&&(0,n.isString)(e.role)&&["user","assistant"].includes(e.role),s="content"in e&&((0,n.isString)(e.content)||(0,n.isArray)(e.content)&&e.content.every(i));return t&&s},o=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},l=e=>{const t=[];if("string"===typeof e.content){const s=(0,r.ZI)({type:"message",content:e.content,role:e.role});s&&t.push(s)}else{const{messages:s,textParts:n,toolCalls:i}=(e=>{const t=[],s=[],n=[];for(const r of e)"text"===r.type||"image"===r.type?s.push(o(r)):"tool_use"===r.type?n.push({id:r.id,function:{name:r.name,arguments:JSON.stringify(r.input)}}):"tool_result"===r.type&&t.push({role:"tool",tool_call_id:r.tool_use_id,content:r.content});return{messages:t,textParts:s,toolCalls:n}})(e.content);if(t.push(...s),n.length>0||i.length>0){const s=(0,r.ZI)({type:"message",content:n.length>0?n:void 0,role:e.role,...i.length>0&&{tool_calls:i}});s&&t.push(s)}}return t},d=e=>{if(!(0,n.isObject)(e))return null;if("messages"in e&&(0,n.isArray)(e.messages)&&e.messages.every(a)){const t=[];for(const s of e.messages)t.push(...l(s));return t}return null},c=e=>(0,n.isObject)(e)&&(0,n.has)(e,"type")&&"message"===e.type&&a(e)?l(e):null,u=e=>(0,n.isObject)(e)&&"text"in e&&(0,n.isString)(e.text),p=e=>(0,n.isObject)(e)&&"role"in e&&(0,n.isString)(e.role)&&["user","model"].includes(e.role)&&(0,n.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(u),m=e=>(0,n.isObject)(e)&&"content"in e&&p(e.content),g=e=>{if(!(0,n.isObject)(e))return null;if("contents"in e){if((0,n.isString)(e.contents)){const t=(0,r.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,n.isArray)(e.contents)&&e.contents.every(p))return(0,n.compact)(e.contents.map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})})))}return null},h=e=>(0,n.isObject)(e)&&"candidates"in e&&(0,n.isArray)(e.candidates)&&e.candidates.every(m)?(0,n.compact)(e.candidates.flatMap((e=>e.content)).map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})}))):null;var f=s(76901);const v=e=>{var t;let s,i;switch(e.type){case"user":case"human":s="user";break;case"assistant":case"ai":s="assistant";break;case"system":s="system";break;case"tool":s="tool";break;case"function":s="function";break;default:return null}if((0,n.isString)(e.content))i=e.content;else if(Array.isArray(e.content)){i=e.content.map((e=>{var t;return(0,n.isString)(e)?e:"text"===e.type&&e.text?e.text:"image_url"===e.type&&null!==(t=e.image_url)&&void 0!==t&&t.url?`![](${e.image_url.url})`:""})).filter(Boolean).join("\n\n")}else i=void 0;const a={content:i,role:s},o=e.tool_calls,l=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,n.isNil)(o)&&Array.isArray(o)&&o.length>0&&o.every(b)?a.tool_calls=(0,n.compact)(o.map(x)):!(0,n.isNil)(l)&&Array.isArray(l)&&l.length>0&&l.every(r.h8)&&(a.tool_calls=l.map(r.CL)),(0,n.isNil)(e.tool_call_id)||(a.tool_call_id=e.tool_call_id),a},x=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),y=e=>!!e&&(!!((0,n.isNil)(e.content)||(0,n.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),b=e=>e&&(0,n.isString)(e.name)&&(0,n.has)(e,"args")&&(0,n.isString)(e.id),Y=e=>e&&y(e.message),S=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(y)){const t=e[0].map(v);return t.some((e=>null===e))?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(y)){const t=e.messages.map(v);return t.some((e=>null===e))?null:t}if(Array.isArray(e)&&e.length>0&&e.every(y)){const t=e.map(v);return t.some((e=>null===e))?null:t}return null},A=e=>{const t=e.map((e=>v(e.message)));return t.some((e=>null===e))?null:t},w=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(Y))(e)?A(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(Y)?A(e.generations[0]):null;var T=s(79912);const M=e=>{if((0,n.has)(e,"messages")&&(0,n.isArray)(e.messages)){return e.messages.map((e=>(0,r.ZI)({type:"message",content:e.content,role:e.role}))).filter(Boolean)}return null},D=e=>{if((0,n.isArray)(e)&&e.length>0&&e.every(n.isString)){const t=e.join("\n"),s=(0,r.ZI)({type:"message",content:t,role:"assistant"});return s&&[s]}return null}}}]);
//# sourceMappingURL=7836.f2717175.chunk.js.map